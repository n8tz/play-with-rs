{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/process/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///(webpack)/buildin/harmony-module.js","webpack:///./src/Scope.js","webpack:///./src/Store.js","webpack:///./src/index.js","webpack:///./src/utils/Emitter.js","webpack:///./src/utils/TaskSequencer.js","webpack:///./src/utils/utils.js","webpack:///external \"@babel/runtime/helpers/possibleConstructorReturn\"","webpack:///external \"@babel/runtime/helpers/defineProperty\"","webpack:///external \"@babel/runtime/helpers/getPrototypeOf\"","webpack:///external \"@babel/runtime/helpers/classCallCheck\"","webpack:///external \"@babel/runtime/helpers/createClass\"","webpack:///external \"@babel/runtime/helpers/toConsumableArray\"","webpack:///external \"@babel/runtime/helpers/get\"","webpack:///external \"is\"","webpack:///external \"@babel/runtime/helpers/inherits\"","webpack:///external \"shortid\"","webpack:///external \"@babel/runtime/helpers/assertThisInitialized\""],"names":["__proto__push","target","id","parent","fn","prototype","_","allScopes","Scope","sm","state","_refs","actions","path","applier","Object","keys","forEach","key","cpath","scopeRef","push","Function","Store","as","scopes","skey","is","array","sort","a","b","firstname","join","storesMap","upperScope","snapshot","data","incrementId","persistenceTm","autoDestroy","rootEmitter","boundedActions","keyPID","_id","shortid","generate","baseId","isLocalId","register","i","_rev","stores","_autoDestroy","constructor","dead","Error","sources","childScopes","childScopesList","unStableChilds","seenChilds","_listening","_scope","_mixed","_mixedList","followers","__retains","all","__locks","_boundedActions","test","includes","bind","retain","_stable","wait","on","_parentList","s","release","_propag","_addChild","restore","setTimeout","tm","dispose","storeIdList","storeId","_mount","arguments","ref","parseRef","reduceRight","mounted","ctx","store","taskQueue","isStoreClass","name","length","shift","isScopeClass","$parent","mount","slice","isStore","undefined","setState","isScope","_watchStore","relink","isScopable","console","warn","singleton","srcCtx","targetCtx","external","force","me","hotReloading","activeActions","__proto__","__onHotReloaded","defineProperty","enumerable","configurable","get","set","v","_mapActions","act","hasOwnProperty","object","__targetStores","dispatch","isStable","propag","lists","__origin","setInitial","revMap","lastRevs","refKeys","map","string","reduce","revs","rev","refs","retainStores","getUpdates","disposeStores","splice","refList","mixedCWUnmount","unMountKey","isReactComponent","unBind","walknSet","alias","retrieve","split","obj","cScope","retrieveStore","storesRevMap","local","updated","getStoresRevs","_getRevMap","output","childs","_getAllChilds","cfg","parentAlias","sid","serialize_ex","exclude","withChilds","withMixed","norefs","keyWalknGet","keyWalknSet","serialize","withChild","withParents","h","k","bool","snap","takeSnapshotByKey","destroy","startsWith","substr","getSnapshotByKey","deleteSnapshotByKey","replace","pState","_ref","action","argz","stack","bActs","trigger","cb","once","e","then","onceStableTree","reason","emit","error","stabilizerTM","clearTimeout","propagTM","remaps","scope","wasStable","indexOf","un","destroyTM","removeListener","follower","_rmChild","EventEmitter","isPrototypeOf","require","TaskSequencer","objProto","getPrototypeOf","_static","getScope","staticScope","watchs","use","apply","initialState","defaultState","_uid","_onStabilize","_persistenceTm","_cfg","scopeObj","$scope","$stores","$actions","$dispatch","_revs","_require","_sources","_use","match","ref2","_followers","_changesSW","_afterConstructor","initialData","applied","_nextState","shouldApply","managed","nDatas","r","cDatas","isComplete","follow","call","changes","_stabilizer","pushTask","ns","nextState","hasDataChange","stable","forcedState","nextData","sync","change","pushState","stabilize","sId","refsCount","persistent","shouldSerialize","dataRefs","stateKeys","stateRefs","inRefsCount","inRefs","number","immediate","restoreRefPath","previous","shouldPropag","_destroyTM","removeAllListeners","cStore","origin","targetRevs","targetScope","initialOutputs","filter","_key","defaultName","o","$global","window","global","RS","___rescope","Emitter","_events","evt","curWeight","maxWeight","minWeight","taskCount","deSync","deSyncMaxTasks","task","isRunning","errorCatcher","lastError","disable","handleError","runNow","enable","addEventListener","process","removeEventListener","run","from","Date","now","weight","Math","max","min","value","walknGet","isKey"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA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","file":"reScope.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","module.exports = function(originalModule) {\n\tif (!originalModule.webpackPolyfill) {\n\t\tvar module = Object.create(originalModule);\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"exports\", {\n\t\t\tenumerable: true\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","/*\n *\n * Copyright (C) 2019 Nathanael Braun\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport is                                   from \"is\";\nimport shortid                              from \"shortid\";\nimport EventEmitter                         from \"./utils/Emitter\";\nimport {keyWalknGet, keyWalknSet, walknSet} from './utils/utils';\n\nconst __proto__push = ( target, id, parent ) => {\n\t      let fn       = function () {\n\t      };\n\t      fn.prototype = parent ? new parent._[id]() : target[id] || {};\n\t      target[id]   = new fn();\n\t      target._[id] = fn;\n      },\n      allScopes     = {};\n\n\n/**\n * Base Scope object\n */\nclass Scope extends EventEmitter {\n\t\n\tstatic persistenceTm = 1;// if > 0, will wait 'persistenceTm' ms before destroy when dispose reach 0\n\tstatic Store         = null;\n\tstatic scopeRef      = function scopeRef( path ) {\n\t\tthis.path = path;\n\t};\n\tstatic scopes        = allScopes;// all active scopes\n\t/**\n\t * get a parsed reference list from stateMap\n\t * @param _ref\n\t * @returns {{storeId, path, alias: *, ref: *}}\n\t */\n\tstatic stateMapToRefList( sm, state = {}, _refs = [], actions = {}, path = \"\" ) {\n\t\tlet applier;\n\t\tObject.keys(sm).forEach(\n\t\t\tkey => {\n\t\t\t\tlet cpath = path ? path + '.' + key : key;\n\t\t\t\t\n\t\t\t\tsm[key] instanceof Scope.scopeRef ?\n\t\t\t\t_refs.push(sm[key].path + ':' + cpath) :\n\t\t\t\t(sm[key] && sm[key] instanceof Function) ?\n\t\t\t\tkey === \"$apply\" ?\n\t\t\t\tapplier = sm[key] :\n\t\t\t\tactions[key] = sm[key] :\n\t\t\t\t(sm[key] && sm[key].prototype instanceof Scope.Store) ?\n\t\t\t\t_refs.push(sm[key].as(cpath)) :\n\t\t\t\t\t//key === \"$actions\" ?\n\t\t\t\t\t//Object.assign(actions, sm[key]) :\n\t\t\t\tstate[cpath] = sm[key]\n\t\t\t\t//: this.stateMapToRefList(sm[key], _refs, path + '.' + key)\n\t\t\t}\n\t\t)\n\t\treturn applier;\n\t}\n\t\n\tstatic getScope( scopes ) {\n\t\tlet skey = is.array(scopes) ? scopes.sort(( a, b ) => {\n\t\t\tif ( a.firstname < b.firstname ) return -1;\n\t\t\tif ( a.firstname > b.firstname ) return 1;\n\t\t\treturn 0;\n\t\t}).join('+') : scopes;\n\t\treturn allScopes[skey] = allScopes[skey] || new Scope({}, { id: skey });\n\t};\n\t\n\t\n\t/**\n\t * Init a ReScope scope\n\t *\n\t * @param storesMap {Object} Object with the initial stores definition / instances\n\t * @param config {Object} Scope config\n\t * {\n\t *     parent {scope} @optional parent scope\n\t *\n\t *     id {string} @optional id ( if this id exist storesMap will be merge on the 'id'\n\t *     scope)\n\t *     key {string} @optional key of the scope ( if no id is set, the scope id will be (parent.id+'>'+key)\n\t *     incrementId {bool} @optional true to add a suffix id, if the provided key or id globally exist\n\t *\n\t *     state {Object} @optional initial state by store alias\n\t *     data {Object} @optional initial data by store alias\n\t *\n\t *     rootEmitter {bool} @optional true to not being destabilized by parent\n\t *     boundedActions {array | regexp} @optional list or regexp of actions not propagated to the parent\n\t *     autoDestroy {true | false | 'inherit'}\n\t *     persistenceTm {number) if > 0, will wait 'persistenceTm' ms before destroy when\n\t *     dispose reach 0 autoDestroy  {bool} will trigger retain & dispose after start\n\t *  }\n\t * @returns {Scope}\n\t */\n\tconstructor( storesMap, { parent, upperScope, key, id, snapshot, state, data, incrementId = !!key, persistenceTm, autoDestroy, rootEmitter, boundedActions } = {} ) {\n\t\tsuper();\n\t\tlet _ = {\n\t\t\tkeyPID: (upperScope && upperScope._id || parent && parent._id || shortid.generate()),\n\t\t\tkey,\n\t\t\tincrementId,\n\t\t\tbaseId: id\n\t\t};\n\t\t\n\t\t\n\t\t// generate / set this scope id\n\t\tid = id || key && (_.keyPID + '>' + key);\n\t\t\n\t\t_.isLocalId = !id;\n\t\t\n\t\tid = id || (\"_____\" + shortid.generate());\n\t\t\n\t\tif ( allScopes[id] && !incrementId ) {// overwrite existing scope\n\t\t\tthis._id = id;\n\t\t\tallScopes[id].register(storesMap);\n\t\t\treturn allScopes[id]\n\t\t}\n\t\telse if ( allScopes[id] && incrementId ) {// generate key id\n\t\t\tlet i = -1;\n\t\t\twhile ( allScopes[id + '[' + (++i) + ']'] ) ;\n\t\t\tid = id + '[' + i + ']';\n\t\t}\n\t\t\n\t\t// register this scope in the static Scope.scopes\n\t\tallScopes[id] = this;\n\t\t\n\t\tthis._id  = id;\n\t\tthis._rev = 0;\n\t\t\n\t\tthis._ = _;\n\t\t\n\t\tthis.actions = {};\n\t\tthis.stores  = {};\n\t\tthis.state   = {};\n\t\tthis.data    = {};\n\t\t\n\t\tthis.parent = parent;\n\t\t\n\t\tif ( autoDestroy == 'inherit' )\n\t\t\tautoDestroy = parent && parent._autoDestroy;\n\t\t\n\t\tthis._autoDestroy = autoDestroy;\n\t\t_.persistenceTm   = persistenceTm || this.constructor.persistenceTm;\n\t\t\n\t\tif ( parent && parent.dead )\n\t\t\tthrow new Error(\"Can't use a dead scope as parent !\");\n\t\t\n\t\t__proto__push(this, 'actions', parent);\n\t\t__proto__push(this, 'stores', parent);\n\t\t__proto__push(this, 'state', parent);\n\t\t__proto__push(this, 'data', parent);\n\t\t\n\t\tthis.sources      = [];\n\t\t_.childScopes     = [];\n\t\t_.childScopesList = [];\n\t\t_.unStableChilds  = 0;\n\t\t_.seenChilds      = 0;\n\t\t_._listening      = {};\n\t\t_._scope          = {};\n\t\t_._mixed          = [];\n\t\t_._mixedList      = [];\n\t\t_.followers       = [];\n\t\t\n\t\tthis.__retains = { all: 0 };\n\t\tthis.__locks   = { all: 1 };\n\t\t\n\t\t// todo\n\t\t_._boundedActions = is.array(boundedActions)\n\t\t                    ? { test: boundedActions.includes.bind(boundedActions) }\n\t\t                    : boundedActions;\n\t\t\n\t\t// register to the parent scope\n\t\tif ( parent ) {\n\t\t\tparent.retain(\"isMyParent\");\n\t\t\tif ( !rootEmitter ) {\n\t\t\t\t!parent._stable && this.wait(\"waitingParent\");\n\t\t\t\tparent.on(_._parentList = {\n\t\t\t\t\t'stable'  : s => this.release(\"waitingParent\"),\n\t\t\t\t\t'unstable': s => this.wait(\"waitingParent\"),\n\t\t\t\t\t'update'  : s => this._propag()\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tparent.on(_._parentList = {\n\t\t\t\t\t'update': s => this._propag()\n\t\t\t\t});\n\t\t\t}\n\t\t\t// this.register(parent.__scope, state, data);\n\t\t}\n\t\t\n\t\t// register this scope stores\n\t\tthis.register(storesMap, state, data);\n\t\tthis.__locks.all--;\n\t\tthis._stable = !this.__locks.all;\n\t\t\n\t\tif ( parent ) {\n\t\t\tparent._addChild(this);\n\t\t}\n\t\t\n\t\t\n\t\t// restore snapshots\n\t\tthis.restore(snapshot);\n\t\t\n\t\t\n\t\tif ( autoDestroy )\n\t\t\tsetTimeout(\n\t\t\t\ttm => {\n\t\t\t\t\tthis.retain(\"autoDestroy\");\n\t\t\t\t\tthis.dispose(\"autoDestroy\");\n\t\t\t\t}\n\t\t\t)\n\t\t\n\t}\n\t\n\t/**\n\t *\n\t * Mount the stores in storesList, in this scope or in its parents or mixed scopes\n\t *\n\t * @param storeIdList {string|storeRef} Store name, Array of Store names, or Rescope\n\t *     store ref from Store::as or Store:as\n\t * @param state\n\t * @param data\n\t * @returns {Scope}\n\t */\n\tmount( storeIdList, snapshot, state, data ) {\n\t\tif ( is.array(storeIdList) ) {\n\t\t\tstoreIdList.forEach(storeId => this._mount(storeId, snapshot, state, data));\n\t\t}\n\t\telse {\n\t\t\tthis._mount(...arguments);\n\t\t}\n\t\treturn this;\n\t}\n\t\n\t_mount( id, snapshot, state, data ) {\n\t\tlet ref, _ = this._;\n\t\t\n\t\tref = this.parseRef(id)\n\t\t\n\t\tif ( id == \"$parent\" ) return;\n\t\tif ( !_._scope[ref.storeId] ) {//ask mixed || parent\n\t\t\tif ( _._mixed.reduceRight(( mounted, ctx ) => (mounted || ctx._mount(id, snapshot, state, data)), false) ||\n\t\t\t\t!this.parent )\n\t\t\t\treturn;\n\t\t\treturn this.parent._mount(...arguments);\n\t\t}\n\t\telse {\n\t\t\tlet store = _._scope[ref.storeId], taskQueue = [];\n\t\t\tif ( Scope.isStoreClass(store) ) {\n\t\t\t\t_._scope[ref.storeId] = new store(this, {\n\t\t\t\t\t//snapshot,\n\t\t\t\t\tname: ref.storeId,\n\t\t\t\t\tstate,\n\t\t\t\t\tdata\n\t\t\t\t}, taskQueue);\n\t\t\t\twhile ( taskQueue.length ) taskQueue.shift()();\n\t\t\t}\n\t\t\telse if ( Scope.isScopeClass(store) ) {\n\t\t\t\tstore = _._scope[ref.storeId] = new store({ $parent: this }, {\n\t\t\t\t\tkey        : ref.storeId,\n\t\t\t\t\tincrementId: true,\n\t\t\t\t\tupperScope : this\n\t\t\t\t\t//autoDestroy: true\n\t\t\t\t\t//parent: this\n\t\t\t\t});\n\t\t\t\t//_._scope[ ref.storeId ].retain(\"scopedChildScope\");\n\t\t\t\t//_watchStore(ref.storeId);\n\t\t\t\tif ( ref.path.length > 1 )\n\t\t\t\t\t_._scope[ref.storeId].mount(ref.path.slice(1).join('.'), snapshot, state, data)\n\t\t\t\t//else return _._scope[ ref.storeId ];\n\t\t\t}\n\t\t\tif ( Scope.isStore(store) ) {\n\t\t\t\tif ( state !== undefined && data === undefined )\n\t\t\t\t\tstore.setState(state);\n\t\t\t\telse if ( state !== undefined )\n\t\t\t\t\tstore.state = state;\n\t\t\t\t\n\t\t\t\tif ( data !== undefined )\n\t\t\t\t\tstore.push(data);\n\t\t\t}\n\t\t\tif ( Scope.isScope(store) ) {\n\t\t\t\tif ( state !== undefined )\n\t\t\t\t\tstore.setState(state);\n\t\t\t\tif ( ref.path.length > 1 )\n\t\t\t\t\tstore._mount(ref.path.slice(1).join('.'))\n\t\t\t}\n\t\t\tthis._watchStore(ref.storeId);\n\t\t}\n\t\t\n\t\t\n\t\treturn _._scope[ref.storeId];\n\t}\n\t\n\t/**\n\t * Register stores in storesMap & link them in the protos\n\t * @param storesMap\n\t * @param state\n\t * @param data\n\t */\n\tregister( storesMap, state = {}, data = {} ) {\n\t\tthis.relink(storesMap, this, false, false);\n\t\tObject.keys(storesMap).forEach(\n\t\t\tid => {\n\t\t\t\tif ( id === \"$parent\" ) return;\n\t\t\t\t\n\t\t\t\tif ( !Scope.isScopable(storesMap[id]) )\n\t\t\t\t\treturn console.warn(\"RS: \", this._id, \", can't register not scopable object :\", id);\n\t\t\t\t\n\t\t\t\tif ( storesMap[id].singleton || (is.fn(storesMap[id]) && (state[id] || data[id])) ) {\n\t\t\t\t\tthis._mount(id, undefined, state[id], data[id])\n\t\t\t\t}\n\t\t\t\telse if ( state[id] || data[id] ) {\n\t\t\t\t\tif ( data[id] ) {\n\t\t\t\t\t\tif ( state[id] )\n\t\t\t\t\t\t\tthis.stores[id].state = state[id];\n\t\t\t\t\t\tthis.stores[id].push(data[id]);\n\t\t\t\t\t}\n\t\t\t\t\telse if ( state[id] ) {\n\t\t\t\t\t\tthis.stores[id].setState(state[id]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._watchStore(id);\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\n\t}\n\t\n\t/**\n\t * Map srcCtx store's on targetCtx headers proto's\n\t * @param srcCtx\n\t * @param targetCtx\n\t * @param state\n\t * @param data\n\t */\n\trelink( srcCtx, targetCtx = this, external, force ) {\n\t\tlet _ = this._, me = this;\n\t\tObject.keys(srcCtx)\n\t\t      .forEach(\n\t\t\t      id => {\n\t\t\t\t      let hotReloading, actions, activeActions;\n\t\t\t\t\n\t\t\t\t      // same store def : ignore\n\t\t\t\t      if ( !force && targetCtx._._scope[id] === srcCtx[id] ||\n\t\t\t\t\t      targetCtx._._scope[id] && (targetCtx._._scope[id].constructor === srcCtx[id]) )\n\t\t\t\t\t      return;\n\t\t\t\t\n\t\t\t\t      // hot switch\n\t\t\t\t      if ( !force && targetCtx._._scope[id] ) {\n\t\t\t\t\t\n\t\t\t\t\t      if ( !external && !is.fn(targetCtx._._scope[id]) ) {// mounted store\n\t\t\t\t\t\t      targetCtx._._scope[id].__proto__ = srcCtx[id].prototype;\n\t\t\t\t\t\t      targetCtx._._scope[id].__onHotReloaded\n\t\t\t\t\t\t      && targetCtx._._scope[id].__onHotReloaded(srcCtx[id]);\n\t\t\t\t\t      }\n\t\t\t\t\t      else if ( !external && is.fn(targetCtx._._scope[id]) )\n\t\t\t\t\t\t      targetCtx._._scope[id] = srcCtx[id];\n\t\t\t\t\t\n\t\t\t\t      }\n\t\t\t\t      else if ( !force && !external )\n\t\t\t\t\t      _._scope[id] = srcCtx[id];\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t      // map the store id\n\t\t\t\t      Object.defineProperty(\n\t\t\t\t\t      targetCtx._.stores.prototype,\n\t\t\t\t\t      id,\n\t\t\t\t\t      {\n\t\t\t\t\t\t      enumerable  : true,\n\t\t\t\t\t\t      configurable: true,\n\t\t\t\t\t\t      get         : () => _._scope[id]\n\t\t\t\t\t      }\n\t\t\t\t      );\n\t\t\t\t\n\t\t\t\t      activeActions = targetCtx._.actions.prototype;\n\t\t\t\t      // not mapping hierarchic scopes\n\t\t\t\t      if ( id !== \"$parent\" ) {\n\t\t\t\t\t      // map state & data\n\t\t\t\t\t      Object.defineProperty(\n\t\t\t\t\t\t      targetCtx._.state.prototype,\n\t\t\t\t\t\t      id,\n\t\t\t\t\t\t      {\n\t\t\t\t\t\t\t      enumerable  : true,\n\t\t\t\t\t\t\t      configurable: true,\n\t\t\t\t\t\t\t      get         : () => (_._scope[id] && _._scope[id].state),\n\t\t\t\t\t\t\t      set         : ( v ) => (this._mount(id, undefined, v))\n\t\t\t\t\t\t      }\n\t\t\t\t\t      );\n\t\t\t\t\t      Object.defineProperty(\n\t\t\t\t\t\t      targetCtx._.data.prototype,\n\t\t\t\t\t\t      id,\n\t\t\t\t\t\t      {\n\t\t\t\t\t\t\t      enumerable  : true,\n\t\t\t\t\t\t\t      configurable: true,\n\t\t\t\t\t\t\t      get         : () => (_._scope[id] && _._scope[id].data),\n\t\t\t\t\t\t\t      set         : ( v ) => (this._mount(id, undefined, undefined, v))\n\t\t\t\t\t\t      }\n\t\t\t\t\t      );\n\t\t\t\t\t      // action mapping\n\t\t\t\t\t      actions = srcCtx[id] instanceof Scope.Store\n\t\t\t\t\t                ? srcCtx[id].constructor.actions\n\t\t\t\t\t                : srcCtx[id].actions;\n\t\t\t\t\t\n\t\t\t\t\t      if ( Scope.isScopeClass(_._scope[id]) )\n\t\t\t\t\t\t      this._mount(id);\n\t\t\t\t\t\n\t\t\t\t\t      if ( Scope.isScope(_._scope[id]) ) {// map hierarchic scopes\n\t\t\t\t\t\t      if ( activeActions[id] )\n\t\t\t\t\t\t\t      console.warn(\"RS : Sub scope actions is mapped over an existing function !\", id);\n\t\t\t\t\t\t\n\t\t\t\t\t\t      activeActions[id] = _._scope[id].actions;\n\t\t\t\t\t      }\n\t\t\t\t\t      else if ( !Scope.isStore(_._scope[id]) && !Scope.isStoreClass(_._scope[id]) )\n\t\t\t\t\t\t      return;\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t      actions &&\n\t\t\t\t\t      this._mapActions(actions, activeActions, id)\n\t\t\t\t      }\n\t\t\t\t      else {\n\t\t\t\t\t      activeActions[id] = srcCtx[id].actions;\n\t\t\t\t      }\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t      // remount the store if it was hot reloaded\n\t\t\t\t      if ( hotReloading )\n\t\t\t\t\t      this._mount(id, null, hotReloading);\n\t\t\t      }\n\t\t      )\n\t}\n\t\n\t/**\n\t * Map & bounds actions from stores\n\t * todo : unmap actions\n\t * @param actions\n\t * @param target\n\t * @param storeId\n\t * @private\n\t */\n\t_mapActions( actions, target, storeId ) {\n\t\tfor ( let act in actions ) {\n\t\t\tif ( actions.hasOwnProperty(act) ) {\n\t\t\t\tif ( is.object(actions[act]) ) {// hirarchised actions\n\t\t\t\t\t\n\t\t\t\t\tif ( target[act] && !is.object(target[act]) )\n\t\t\t\t\t\tconsole.warn(\"RS : Actions namespace is mapped over an existing function !\", storeId, act);\n\t\t\t\t\t\n\t\t\t\t\ttarget[act] = target[act] || { __targetStores: 0 };\n\t\t\t\t\tthis._mapActions(actions[act], target[act]);\n\t\t\t\t\ttarget[act].__targetStores++;\n\t\t\t\t}\n\t\t\t\telse if ( target.hasOwnProperty(act) )\n\t\t\t\t\ttarget[act].__targetStores++;\n\t\t\t\telse {\n\t\t\t\t\tif ( is.object(target[act]) )\n\t\t\t\t\t\tconsole.warn(\"RS : Action is mapped over existing namespace  !\", storeId, act);\n\t\t\t\t\ttarget[act]                = this.dispatch.bind(this, act);\n\t\t\t\t\ttarget[act].__targetStores = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Make this scope watching the local store 'id'\n\t * @param id\n\t * @returns {boolean}\n\t * @private\n\t */\n\t_watchStore( id ) {\n\t\tlet _ = this._;\n\t\tif ( !_._listening[id] && !is.fn(_._scope[id]) ) {\n\t\t\t!_._scope[id]._autoDestroy && _._scope[id].retain(\"scoped\");\n\t\t\t!_._scope[id].isStable() && this.wait(id);\n\t\t\t_._scope[id].on(\n\t\t\t\t_._listening[id] = {\n\t\t\t\t\t'destroy' : s => {\n\t\t\t\t\t\tdelete _._listening[id];\n\t\t\t\t\t\t_._scope[id] = _._scope[id].constructor;\n\t\t\t\t\t},\n\t\t\t\t\t'update'  : s => this.propag(),\n\t\t\t\t\t'stable'  : s => this.release(id),\n\t\t\t\t\t'unstable': s => this.wait(id)\n\t\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n\t\n\t/**\n\t * Mix targetCtx on this scope\n\t * Mixed scope parents are NOT mapped\n\t * @param targetCtx\n\t */\n\tmixin( targetCtx ) {\n\t\tlet parent = this.parent,\n\t\t    lists,\n\t\t    _      = this._;\n\t\t\n\t\t_._mixed.push(targetCtx);\n\t\t\n\t\ttargetCtx.retain(\"mixedTo\");\n\t\t\n\t\tif ( !targetCtx._stable )\n\t\t\tthis.wait(targetCtx._id);\n\t\t\n\t\t_._mixedList.push(lists = {\n\t\t\t'stable'  : s => this.release(targetCtx._id),\n\t\t\t'unstable': s => this.wait(targetCtx._id),\n\t\t\t'update'  : s => this._propag()\n\t\t});\n\t\t\n\t\ttargetCtx.on(lists);\n\t\t\n\t\t// reset protos\n\t\t// push new proto with parent\n\t\t__proto__push(this, 'actions', parent);\n\t\t__proto__push(this, 'stores', parent);\n\t\t__proto__push(this, 'state', parent);\n\t\t__proto__push(this, 'data', parent);\n\t\t\n\t\t// bind local accessors in the new proto\n\t\tthis.relink(_._scope, this, false, true);\n\t\t\n\t\t_._mixed.forEach(\n\t\t\tctx => {\n\t\t\t\t// push protos\n\t\t\t\t__proto__push(this, 'actions');\n\t\t\t\t__proto__push(this, 'stores');\n\t\t\t\t__proto__push(this, 'state');\n\t\t\t\t__proto__push(this, 'data');\n\t\t\t\tthis.stores.__origin = \"mixed \" + ctx._id;\n\t\t\t\t// write mixed accessors\n\t\t\t\tctx.relink(ctx._._scope, this, true, true)\n\t\t\t}\n\t\t)\n\t}\n\t\n\t/**\n\t * Bind stores from this scope, his parents or mixed scopes to obj\n\t *\n\t * @param target {React.Component|Store|function}\n\t * @param key {string} stores keys to bind updates\n\t * @param as\n\t * @param setInitial {boolean} false to not propag initial value (default : true)\n\t */\n\tbind( target, key, as, setInitial = true, revMap = {} ) {\n\t\tlet lastRevs, data, refKeys;\n\t\tif ( key && !is.array(key) )\n\t\t\tkey = [key];\n\t\t\n\t\tif ( as === false || as === true ) {\n\t\t\tsetInitial = as;\n\t\t\tas         = null;\n\t\t}\n\t\t\n\t\trefKeys = key\n\t\t\t.map(id => (is.string(id) ? id : id.name))\n\t\t\t.map(id => (this.parseRef(id)));\n\t\t\n\t\t\n\t\tthis._.followers.push(\n\t\t\t[\n\t\t\t\ttarget,\n\t\t\t\tkey,\n\t\t\t\tas || undefined,\n\t\t\t\tlastRevs = refKeys.reduce(( revs, ref ) => {\n\t\t\t\t\trevs[ref.storeId] = revs[ref.storeId] || {\n\t\t\t\t\t\trev : 0,\n\t\t\t\t\t\trefs: []\n\t\t\t\t\t};\n\t\t\t\t\trevs[ref.storeId].refs.push(ref);\n\t\t\t\t\treturn revs;\n\t\t\t\t}, revMap)\n\t\t\t]);\n\t\t\n\t\tthis.mount(key);\n\t\tthis.retainStores(Object.keys(lastRevs), 'listeners');\n\t\t\n\t\tif ( setInitial && this._stable ) {\n\t\t\tdata = this.getUpdates(lastRevs);\n\t\t\tif ( !data ) return this;\n\t\t\tif ( typeof target != \"function\" ) {\n\t\t\t\tif ( as ) target.setState({ [as]: data });\n\t\t\t\telse target.setState(data);\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttarget(data);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Un bind this scope off the given component-keys\n\t * @param target\n\t * @param key\n\t * @returns {Array.<*>}\n\t */\n\tunBind( target, key, as ) {\n\t\tlet followers = this._.followers,\n\t\t    i         = followers && followers.length;\n\t\twhile ( followers && i-- )\n\t\t\tif ( followers[i][0] === target &&\n\t\t\t\t('' + followers[i][1]) == ('' + key) &&\n\t\t\t\tfollowers[i][2] == as ) {\n\t\t\t\tthis.disposeStores(Object.keys(followers[i][3]), 'listeners');\n\t\t\t\treturn followers.splice(i, 1);\n\t\t\t}\n\t}\n\t\n\t/**\n\t * Mount the stores in storeIdList from this scope, its parents and mixed scope\n\t * Bind them to 'to'\n\t * Hook 'to' so it will auto unbind on 'destroy' or 'componentWillUnmount'\n\t * @param target\n\t * @param storeIdList\n\t * @param bind\n\t * @returns {Object} Initial outputs of the stores in 'storesList'\n\t */\n\tmap( target, storeIdList, bind = true, revMap ) {\n\t\tlet Store   = this.constructor.Store;\n\t\tstoreIdList = is.array(storeIdList) ? storeIdList : [storeIdList];\n\t\tlet refList = storeIdList.map(this.parseRef);\n\t\tthis.mount(storeIdList);\n\t\tif ( bind && target instanceof Store ) {\n\t\t\tStore.map(target, storeIdList, this, this, false)\n\t\t}\n\t\telse if ( bind ) {\n\t\t\tthis.bind(target, storeIdList, undefined, false);\n\t\t\t\n\t\t\tlet mixedCWUnmount,\n\t\t\t    unMountKey = target.isReactComponent ? \"componentWillUnmount\" : \"destroy\";\n\t\t\t\n\t\t\tif ( target.hasOwnProperty(unMountKey) ) {\n\t\t\t\tmixedCWUnmount = target[unMountKey];\n\t\t\t}\n\t\t\t\n\t\t\ttarget[unMountKey] = ( ...argz ) => {\n\t\t\t\tdelete target[unMountKey];\n\t\t\t\tif ( mixedCWUnmount )\n\t\t\t\t\ttarget[unMountKey] = mixedCWUnmount;\n\t\t\t\t\n\t\t\t\tthis.unBind(target, storeIdList);\n\t\t\t\treturn target[unMountKey] && target[unMountKey](...argz);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\treturn revMap && this.getUpdates(revMap)\n\t\t\t|| refList.reduce(( data, ref ) => {\n\t\t\t\twalknSet(data, ref.alias || ref.path, this.retrieve(ref.path))\n\t\t\t\treturn data;\n\t\t\t}, {});\n\t}\n\t\n\t/**\n\t * Get current data value from json path\n\t * @param path\n\t * @returns {string|*}\n\t */\n\tretrieve( path = \"\" ) {\n\t\tpath = is.string(path) ? path.split('.') : path;\n\t\t\n\t\t\n\t\treturn path &&\n\t\t\tthis.stores[path[0]] &&\n\t\t\tthis.stores[path[0]].retrieve &&\n\t\t\tthis.stores[path[0]].retrieve(path.slice(1));\n\t}\n\t\n\t/**\n\t * Restore all nodes in a jsonPath\n\t * @param path\n\t * @returns {string|*}\n\t */\n\trestoreRefPath( path = \"\" ) {\n\t\tpath = is.string(path) ? path.split('.') : path;\n\t\t\n\t\tlet obj, i = 0, cScope = this;\n\t\t\n\t\twhile ( i < path.length ) {\n\t\t\tobj = cScope.stores[path[i]];\n\t\t\tif ( Scope.isScopeClass(obj)\n\t\t\t\t||\n\t\t\t\tScope.isStoreClass(obj) ) {\n\t\t\t\tcScope.mount(path[0]);\n\t\t\t\tobj = cScope.stores[path[i]];\n\t\t\t}\n\t\t\t\n\t\t\tif ( Scope.isScope(obj) ) {\n\t\t\t\tcScope = obj;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\telse if ( Scope.isStore(obj) ) {\n\t\t\t\tobj.restore();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t}\n\t\n\t/**\n\t * Get target store from json path\n\t * @param path\n\t * @returns {string|*}\n\t */\n\tretrieveStore( path = \"\" ) {\n\t\tpath = is.string(path) ? path.split('.') : path;\n\t\treturn path\n\t\t\t&& path.length\n\t\t\t&& (\n\t\t\t\tpath.length != 1 && this.stores[path[0]].retrieveStore\n\t\t\t\t? this.stores[path[0]].retrieveStore(path.slice(1))\n\t\t\t\t: path.length == 1 && this.stores[path[0]]\n\t\t\t);\n\t}\n\t\n\t/**\n\t * Get or update stores revisions in 'storesRevMap'\n\t * @param storesRevMap\n\t * @param local\n\t * @returns {{}}\n\t */\n\tgetStoresRevs( storesRevMap = {}, local ) {\n\t\tlet ctx = this._._scope;\n\t\tif ( !storesRevMap ) {\n\t\t\tstoresRevMap = {};\n\t\t}\n\t\tObject.keys(ctx).forEach(\n\t\t\tid => {\n\t\t\t\tif ( id == \"$parent\" ) return;\n\t\t\t\tif ( !is.fn(ctx[id])\n\t\t\t\t) {\n\t\t\t\t\tstoresRevMap[id] = ctx[id]._rev;\n\t\t\t\t}\n\t\t\t\telse if ( !storesRevMap.hasOwnProperty(id) )\n\t\t\t\t\tstoresRevMap[id] = false\n\t\t\t}\n\t\t);\n\t\tif ( !local ) {\n\t\t\tthis._._mixed.reduce(( updated, ctx ) => (ctx.getStoresRevs(storesRevMap), storesRevMap), storesRevMap);\n\t\t\tthis.parent && this.parent.getStoresRevs(storesRevMap);\n\t\t}\n\t\treturn storesRevMap;\n\t}\n\t\n\t/**\n\t * Recursively get all stores revs\n\t * @param childs\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getRevMap( storesRevMap = {} ) {\n\t\tlet ctx = this._._scope;\n\t\tObject.keys(ctx).forEach(\n\t\t\tid => {\n\t\t\t\tif ( id == \"$parent\" || storesRevMap[id] ) return;\n\t\t\t\tstoresRevMap[id] = { rev: ctx[id]._rev, refs: [] };\n\t\t\t\t\n\t\t\t});\n\t\tthis._._mixed.reduceRight(\n\t\t\t( storesRevMap, ctx ) => (ctx._getRevMap(storesRevMap)), storesRevMap);\n\t\tthis.parent && this.parent._getRevMap(storesRevMap);\n\t\treturn storesRevMap;\n\t}\n\t\n\t/**\n\t * Get updated output basing storesRevMap's revisions.\n\t * If a store in 'storesRevMap' was updated; add it to 'output' & update storesRevMap\n\t * @param storesRevMap\n\t * @param output\n\t * @param updated\n\t * @returns {*|{}}\n\t */\n\tgetRefsUpdates( refs, revMap, output ) {\n\t\trevMap = revMap || refs\n\t\t\t.map(id => (is.string(id) ? id : id.name))\n\t\t\t.map(id => (this.parseRef(id)))\n\t\t\t.reduce(( revs, ref ) => {\n\t\t\t\trevs[ref.storeId] = revs[ref.storeId] || {\n\t\t\t\t\trev : 0,\n\t\t\t\t\trefs: []\n\t\t\t\t};\n\t\t\t\trevs[ref.storeId].refs.push(ref);\n\t\t\t\treturn revs;\n\t\t\t}, {});\n\t\t\n\t\treturn this.getUpdates(revMap, output)\n\t}\n\t\n\t/**\n\t * Get or update output basing storesRevMap's revisions.\n\t * If a store in 'storesRevMap' was updated; add it to 'output' & update storesRevMap\n\t * @param storesRevMap\n\t * @param output\n\t * @param updated\n\t * @returns {*|{}}\n\t */\n\tgetUpdates( storesRevMap, output, updated ) {\n\t\toutput       = output || {};\n\t\tstoresRevMap = storesRevMap || this._getRevMap();\n\t\tObject.keys(storesRevMap).forEach(\n\t\t\tid => {\n\t\t\t\tlet store        = this.stores[id];\n\t\t\t\tstoresRevMap[id] = storesRevMap[id] || { rev: 0, refs: [] };\n\t\t\t\t\n\t\t\t\tif ( store && is.fn(store) ) {\n\t\t\t\t\tupdated    = true;\n\t\t\t\t\toutput[id] = undefined;\n\t\t\t\t}\n\t\t\t\telse if ( store && store._rev > storesRevMap[id].rev ) {\n\t\t\t\t\tstoresRevMap[id].rev = store._rev;\n\t\t\t\t\tupdated              = true;\n\t\t\t\t\tstoresRevMap[id].refs.forEach(\n\t\t\t\t\t\tref => {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\toutput[ref.alias] = this.retrieve(ref.path)\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\treturn updated && output;\n\t}\n\t\n\t/**\n\t * Recursively get all child scopes\n\t * @param childs\n\t * @returns {Array}\n\t * @private\n\t */\n\t_getAllChilds( childs = [] ) {\n\t\tchilds.push(...this._.childScopes);\n\t\tthis._.childScopes.forEach(\n\t\t\tctx => {\n\t\t\t\tctx._getAllChilds(childs);\n\t\t\t}\n\t\t);\n\t\treturn childs;\n\t}\n\t\n\t/**\n\t * Serialize all active stores state & data in every childs & mixed scopes\n\t *\n\t * Scopes without key or id are ignored\n\t * @param output\n\t * @returns {{}}\n\t */\n\tserialize( cfg = {}, output = {} ) {\n\t\tlet ctx                                  = this._._scope,\n\t\t    { baseId, key, keyPID, incrementId } = this._,\n\t\t    {\n\t\t\t    alias,\n\t\t\t    parentAlias,\n\t\t    }                                    = cfg,\n\t\t    sid                                  = key\n\t\t                                           ? (parentAlias || keyPID) + '>' + key\n\t\t                                           : alias || parentAlias && (parentAlias + '/' + baseId) || this._id;\n\t\t\n\t\t\n\t\t//alias = alias || baseId;\n\t\treturn this.serialize_ex(cfg, output, sid, alias, [\"$parent\"])\n\t}\n\t\n\tserialize_ex( cfg = {}, output = {}, sid, alias, exclude ) {\n\t\tlet _               = this._,\n\t\t    ctx             = _._scope,\n\t\t    { incrementId } = _,\n\t\t    {\n\t\t\t    withChilds = true,\n\t\t\t    withMixed  = true,\n\t\t\t    norefs,\n\t\t    }               = cfg;\n\t\t\n\t\tif ( keyWalknGet(output, sid) ) {\n\t\t\tif ( !incrementId )// done\n\t\t\t\treturn output;\n\t\t\telse if ( incrementId ) {// generate key id\n\t\t\t\tlet i = -1;\n\t\t\t\twhile ( keyWalknGet(output, sid + '[' + (++i) + ']') ) ;\n\t\t\t\tsid = sid + '[' + i + ']';\n\t\t\t}\n\t\t}\n\t\t\n\t\tkeyWalknSet(output, sid, {});\n\t\t\n\t\tObject.keys(ctx).forEach(\n\t\t\tid => {\n\t\t\t\tif ( exclude.includes(id) || Scope.isStoreClass(ctx[id]) || Scope.isScopeClass(ctx[id]) )\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tctx[id].serialize({ ...cfg, parentAlias: sid }, output);\n\t\t\t}\n\t\t)\n\t\t\n\t\twithChilds && _.childScopes.forEach(\n\t\t\tctx => {\n\t\t\t\t!ctx._.isLocalId && ctx.serialize({\n\t\t\t\t\t                                  withChild  : true,\n\t\t\t\t\t                                  withParents: false,\n\t\t\t\t\t                                  parentAlias: sid,\n\t\t\t\t\t                                  withMixed,\n\t\t\t\t\t                                  norefs,\n\t\t\t\t                                  }, output);\n\t\t\t}\n\t\t);\n\t\t\n\t\twithMixed && _._mixed.forEach(\n\t\t\tctx => {\n\t\t\t\t!ctx._.isLocalId && ctx.serialize({\n\t\t\t\t\t                                  withChild  : false,\n\t\t\t\t\t                                  withParents: false,\n\t\t\t\t\t                                  withMixed,\n\t\t\t\t\t                                  norefs\n\t\t\t\t                                  }, output);\n\t\t\t}\n\t\t);\n\t\t\n\t\tif ( alias ) {\n\t\t\toutput = Object.keys(output)\n\t\t\t               .reduce(\n\t\t\t\t               ( h, k ) => (\n\t\t\t\t\t               h[k === this._id\n\t\t\t\t\t                 ? alias\n\t\t\t\t\t                 : k] = output[k],\n\t\t\t\t\t\t               h\n\t\t\t\t               ),\n\t\t\t\t               {}\n\t\t\t               )\n\t\t}\n\t\treturn output;\n\t}\n\t\n\t/**\n\t * Restore state & data from the serialize fn\n\t * @param snapshot\n\t * @param force\n\t */\n\trestore( snapshot, cfg = {}, force = is.bool(cfg) && cfg ) {\n\t\tlet ctx = this._._scope, snap;\n\t\t\n\t\tif ( snapshot && cfg && cfg.alias && cfg.alias != this._id ) {\n\t\t\tsnap = {\n\t\t\t\t...snapshot,\n\t\t\t\t[this._id]: snapshot[cfg.alias]\n\t\t\t}\n\t\t\tdelete snap[cfg.alias];\n\t\t\tsnapshot = snap;\n\t\t}\n\t\tsnapshot = snapshot\n\t\t\t&& keyWalknGet(snapshot, this._id)\n\t\t\t|| this.takeSnapshotByKey(this._id);\n\t\t\n\t\t\n\t\tif ( !snapshot )\n\t\t\treturn;\n\t\t\n\t\tthis._.snapshot = { ...snapshot };\n\t\t\n\t\tsnap          = snapshot['/'];\n\t\tsnapshot['/'] = { ...snap };\n\t\tsnap && Object.keys(snap).forEach(\n\t\t\tname => {\n\t\t\t\tif ( name == \"$parent\" ) return;\n\t\t\t\t\n\t\t\t\tif ( ctx[name] ) {\n\t\t\t\t\t\n\t\t\t\t\tif ( force && !is.fn(ctx[name]) )\n\t\t\t\t\t\tctx[name].destroy();\n\t\t\t\t\t\n\t\t\t\t\tthis._mount(name);// quiet\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t)\n\t\t\n\t\tthis._._mixed.forEach(\n\t\t\tctx => {\n\t\t\t\t!ctx._.isLocalId && ctx.restore(undefined, force);\n\t\t\t}\n\t\t);\n\t\t\n\t\tthis._.childScopes.forEach(\n\t\t\tctx => {\n\t\t\t\t!ctx._.isLocalId && ctx.restore(undefined, force);\n\t\t\t}\n\t\t);\n\t}\n\t\n\tgetSnapshotByKey( key, local ) {\n\t\t// only have the local snap\n\t\tif ( this._.snapshot && key.startsWith(this._id) ) {\n\t\t\tlet obj = keyWalknGet(this._.snapshot, key.substr(this._id.length))\n\t\t\treturn obj;\n\t\t}\n\t\telse return !local\n\t\t\t&& this.parent\n\t\t\t&& this.parent.getSnapshotByKey(key)\n\t\t\t||\n\t\t\tthis.stores.$parent\n\t\t\t&& this.stores.$parent.getSnapshotByKey(key);\n\t\t\n\t}\n\t\n\tgetSnapshotByKeyExt( snapshot, key, local ) {\n\t\t// only have the local snap\n\t\tif ( snapshot ) {\n\t\t\tlet obj = keyWalknGet(snapshot, key)\n\t\t\treturn obj;\n\t\t}\n\t\t\n\t}\n\t\n\ttakeSnapshotByKey( key, local ) {\n\t\tif ( this._.snapshot && key.startsWith(this._id) ) {\n\t\t\tlet obj = keyWalknGet(this._.snapshot, key.substr(this._id.length))\n\t\t\tif ( obj ) {\n\t\t\t\tthis.deleteSnapshotByKey(key, true);\n\t\t\t}\n\t\t\treturn obj;\n\t\t}\n\t\telse return !local\n\t\t\t&& this.parent\n\t\t\t&& this.parent.takeSnapshotByKey(key)\n\t\t\t||\n\t\t\tthis.stores.$parent\n\t\t\t&& this.stores.$parent.takeSnapshotByKey(key);\n\t}\n\t\n\tdeleteSnapshotByKey( key, local ) {\n\t\tif ( this._.snapshot && key.startsWith(this._id) ) {\n\t\t\tlet obj = keyWalknGet(this._.snapshot, key.substr(this._id.length).replace(/^(.*[\\>|\\/])[^\\>|\\/]+$/ig, '$1'))\n\t\t\tif ( obj )\n\t\t\t\tdelete obj[key.replace(/^.*[\\>|\\/]([^\\>|\\/]+)$/ig, '$1')]\n\t\t}\n\t\treturn !local\n\t\t\t&& this.parent\n\t\t\t&& this.parent.deleteSnapshotByKey(key)\n\t\t\t||\n\t\t\tthis.stores.$parent\n\t\t\t&& this.stores.$parent.deleteSnapshotByKey(key);\n\t}\n\t\n\tsetState( pState ) {\n\t\tObject.keys(pState)\n\t\t      .forEach(k => (this.state[k] = pState[k]))\n\t}\n\t\n\t/**\n\t * get a parsed reference\n\t * @param _ref\n\t * @returns {{storeId, path, alias: *, ref: *}}\n\t */\n\tparseRef( _ref ) {\n\t\tif ( typeof _ref !== 'string' ) {// @todo : rm this\n\t\t\tthis.register({ [_ref.name]: _ref.store });\n\t\t\t_ref = _ref.name;\n\t\t}\n\t\tlet ref = _ref.split(':');\n\t\tref[0]  = ref[0].split('.');\n\t\treturn {\n\t\t\tstoreId: ref[0][0],\n\t\t\tpath   : ref[0],\n\t\t\talias  : ref[1] || ref[0][ref[0].length - 1],\n\t\t\tref    : _ref\n\t\t};\n\t}\n\t\n\t/**\n\t * Dispatch an action to the top parent & mixed scopes, in all stores\n\t * todo\n\t * @param action\n\t * @param data\n\t * @returns {Scope}\n\t */\n\tdispatch( action, ...argz ) {\n\t\tif ( this.dead ) {\n\t\t\tconsole.warn(\"Dispatch was called on a dead scope, check you're async functions in this stack...\", (new Error()).stack);\n\t\t\treturn;\n\t\t}\n\t\tlet bActs = this._._boundedActions;\n\t\tfor ( let storeId in this._._scope ) {\n\t\t\tif ( storeId === \"$parent\" ) continue;\n\t\t\tif ( !is.fn(this._._scope[storeId]) )\n\t\t\t\tthis._._scope[storeId].trigger(action, ...argz);\n\t\t}\n\t\t\n\t\tif ( bActs && bActs.test(action) )\n\t\t\treturn this;\n\t\t\n\t\tthis._._mixed.forEach(( ctx ) => (ctx.dispatch(action, ...argz)));\n\t\tthis.parent && this.parent.dispatch(action, ...argz);\n\t\treturn this;\n\t}\n\t\n\ttrigger() {\n\t\tthis.dispatch(...arguments);\n\t}\n\t\n\t/**\n\t * once('stable', cb)\n\t * @param obj {React.Component|Store|function)\n\t * @param key {string} optional key where to map the public state\n\t */\n\tthen( cb ) {\n\t\tif ( !this._stable )\n\t\t\treturn this.once('stable', e => this.then(cb));\n\t\t\n\t\treturn cb(this.data);\n\t}\n\t\n\tonceStableTree( cb ) {\n\t\tif ( this._.unStableChilds )\n\t\t\treturn this.once('stableTree', e => this.onceStableTree(cb));\n\t\treturn cb(this.data);\n\t}\n\t\n\t/**\n\t * Call retain on the scoped stores basing the given list\n\t *\n\t * @param stores\n\t * @param reason\n\t */\n\tretainStores( stores = [], reason ) {\n\t\tstores.forEach(\n\t\t\tid => (this.stores[id] && this.stores[id].retain && this.stores[id].retain(reason))\n\t\t)\n\t}\n\t\n\t/**\n\t * Call retain on the scoped stores\n\t *\n\t * @param stores\n\t * @param reason\n\t */\n\tdisposeStores( stores = [], reason ) {\n\t\tstores.forEach(\n\t\t\tid => (this.stores[id] && this.stores[id].dispose && this.stores[id].dispose(reason))\n\t\t)\n\t}\n\t\n\t/**\n\t * Keep the scope unstable until release is called\n\t * @param reason\n\t */\n\twait( reason ) {\n\t\t//console.log(\"wait\", reason);\n\t\tthis._stable && !this.__locks.all && this.emit(\"unstable\", this);\n\t\tthis._stable = false;\n\t\tthis.__locks.all++;\n\t\tif ( reason ) {\n\t\t\tthis.__locks[reason] = this.__locks[reason] || 0;\n\t\t\tthis.__locks[reason]++;\n\t\t}\n\t}\n\t\n\t/**\n\t * Stabilize the scope if no more locks remain (wait fn)\n\t * @param reason\n\t */\n\trelease( reason ) {\n\t\t\n\t\tif ( reason ) {\n\t\t\tif ( this.__locks[reason] == 0 )\n\t\t\t\tconsole.error(\"Release more than locking !\", reason);\n\t\t\tthis.__locks[reason] = this.__locks[reason] || 0;\n\t\t\tthis.__locks[reason]--;\n\t\t}\n\t\tif ( !reason && this.__locks.all == 0 )\n\t\t\tconsole.error(\"Release more than locking !\");\n\t\t\n\t\tthis.__locks.all--;\n\t\tif ( !this.__locks.all ) {\n\t\t\tif ( this._.stabilizerTM )\n\t\t\t\treturn;\n\t\t\tthis._.stabilizerTM && clearTimeout(this._.stabilizerTM);\n\t\t\t\n\t\t\tthis._.stabilizerTM = setTimeout(\n\t\t\t\te => {\n\t\t\t\t\tthis._.stabilizerTM = null;\n\t\t\t\t\tif ( this.__locks.all )\n\t\t\t\t\t\treturn;\n\t\t\t\t\t\n\t\t\t\t\tthis._.propagTM && clearTimeout(this._.propagTM);\n\t\t\t\t\tthis._rev++;\n\t\t\t\t\tthis._stable = true;\n\t\t\t\t\tthis.emit(\"stable\", this);\n\t\t\t\t\t\n\t\t\t\t\t!this.dead && this._propag();// stability can induce destroy\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\t\n\t}\n\t\n\t/**\n\t * Propag stores updates basing theirs last updates\n\t */\n\tpropag() {\n\t\tthis._.propagTM && clearTimeout(this._.propagTM);\n\t\tthis._.propagTM = setTimeout(\n\t\t\te => {\n\t\t\t\tthis._.propagTM = null;\n\t\t\t\tthis._propag()\n\t\t\t}, 2\n\t\t);\n\t}\n\t\n\t_propag() {\n\t\tif ( this._.followers.length )\n\t\t\tthis._.followers.forEach(( { 0: obj, 1: key, 2: as, 3: lastRevs, 3: remaps } ) => {\n\t\t\t\tlet data = this.getUpdates(lastRevs);\n\t\t\t\tif ( !data ) return;\n\t\t\t\tif ( typeof obj != \"function\" ) {\n\t\t\t\t\t//console.log(\"setState \",obj, Object.keys(data))\n\t\t\t\t\tif ( as ) obj.setState({ [as]: data });\n\t\t\t\t\telse obj.setState(data);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tobj(data, lastRevs && { ...lastRevs } || \"no revs\");\n\t\t\t\t}\n\t\t\t\t// lastRevs &&\n\t\t\t\t// key.forEach(id => (lastRevs[id] = this.stores[id] &&\n\t\t\t\t// this.stores[id]._rev || 0));\n\t\t\t});\n\t\tthis.emit(\"update\", this.getUpdates());\n\t}\n\t\n\t/**\n\t * is stable\n\t * @returns bool\n\t */\n\tisStable() {\n\t\treturn this._stable;\n\t}\n\t\n\t/**\n\t * is stable tree\n\t * @returns bool\n\t */\n\tisStableTree() {\n\t\treturn !this._.unStableChilds;\n\t}\n\t\n\t/**\n\t * Register children\n\t * @param scope\n\t * @private\n\t */\n\t_addChild( scope ) {\n\t\tthis._.childScopes.push(scope);\n\t\tthis._.seenChilds++;\n\t\tlet lists     = {\n\t\t\t    'stable'      : s => {\n\t\t\t\t    this._.unStableChilds--;\n\t\t\t\t    if ( !this._.unStableChilds )\n\t\t\t\t\t    this.emit(\"stableTree\", this)\n\t\t\t    },\n\t\t\t    'unstable'    : s => {\n\t\t\t\t    this._.unStableChilds++;\n\t\t\t\t    if ( 1 == this._.unStableChilds )\n\t\t\t\t\t    this.emit(\"unstableTree\", this)\n\t\t\t    },\n\t\t\t    'stableTree'  : s => {\n\t\t\t\t    this._.unStableChilds--;\n\t\t\t\t    if ( !this._.unStableChilds )\n\t\t\t\t\t    this.emit(\"stableTree\", this)\n\t\t\t    },\n\t\t\t    'unstableTree': s => {\n\t\t\t\t    this._.unStableChilds++;\n\t\t\t\t    if ( 1 == this._.unStableChilds )\n\t\t\t\t\t    this.emit(\"unstableTree\", this)\n\t\t\t    },\n\t\t\t    'destroy'     : ctx => {\n\t\t\t\t    if ( ctx._.unStableChilds )\n\t\t\t\t\t    this._.unStableChilds--;\n\t\t\t\t    if ( !ctx.isStable() )\n\t\t\t\t\t    this._.unStableChilds--;\n\t\t\t\t\n\t\t\t\t    if ( !this._.unStableChilds )\n\t\t\t\t\t    this.emit(\"stableTree\", this)\n\t\t\t    }\n\t\t    },\n\t\t    wasStable = this._.unStableChilds;\n\t\t\n\t\t!scope.isStable() && this._.unStableChilds++;\n\t\tscope._.unStableChilds && this._.unStableChilds++;\n\t\tthis._.childScopesList.push(lists);\n\t\t\n\t\tif ( !wasStable && this._.unStableChilds )\n\t\t\tthis.emit(\"unstableTree\", this);\n\t\t\n\t\tscope.on(lists);\n\t}\n\t\n\t_rmChild( ctx ) {\n\t\tlet i         = this._.childScopes.indexOf(ctx),\n\t\t    wasStable = this._.unStableChilds;\n\t\tif ( i != -1 ) {\n\t\t\tthis._.childScopes.splice(i, 1);\n\t\t\t!ctx.isStable() && this._.unStableChilds--;\n\t\t\tctx._.unStableChilds && this._.unStableChilds--;\n\t\t\tctx.un(this._.childScopesList.splice(i, 1)[0]);\n\t\t\tif ( wasStable && !this._.unStableChilds )\n\t\t\t\tthis.emit(\"stableTree\")\n\t\t}\n\t}\n\t\n\tretain( reason ) {\n\t\tthis.__retains.all++;\n\t\t//console.log(\"retain\", this._id, reason);\n\t\tif ( reason ) {\n\t\t\tthis.__retains[reason] = this.__retains[reason] || 0;\n\t\t\tthis.__retains[reason]++;\n\t\t}\n\t}\n\t\n\tdispose( reason ) {\n\t\t//console.log(\"dispose\", this._id, reason);\n\t\tif ( reason ) {\n\t\t\tif ( !this.__retains[reason] )\n\t\t\t\tthrow new Error(\"Dispose more than retaining : \" + reason);\n\t\t\tthis.__retains[reason]--;\n\t\t}\n\t\t\n\t\tif ( !this.__retains.all )\n\t\t\tthrow new Error(\"Dispose more than retaining !\");\n\t\t\n\t\tthis.__retains.all--;\n\t\t\n\t\tif ( !this.__retains.all ) {\n\t\t\t//console.log(\"dispose do destroy \", this._id, this._persistenceTm);\n\t\t\tif ( this._.persistenceTm ) {\n\t\t\t\tthis._.destroyTM && clearTimeout(this._.destroyTM);\n\t\t\t\tthis._.destroyTM = setTimeout(\n\t\t\t\t\te => {\n\t\t\t\t\t\tthis.then(s => {\n\t\t\t\t\t\t\t!this.__retains.all && !this.dead && this.destroy()\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tthis._.persistenceTm\n\t\t\t\t);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.then(s =>\n\t\t\t\t\t          (!this.__retains.all && !this.dead && this.destroy())\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * order destroy of local stores\n\t */\n\tdestroy() {\n\t\tlet ctx = this._._scope;\n\t\t[...this._.childScopes].map(scope => scope.destroy())\n\t\tfor ( let key in ctx )\n\t\t\tif ( !is.fn(ctx[key]) ) {\n\t\t\t\tif ( key == \"$parent\" ) continue;\n\t\t\t\t!ctx[key]._autoDestroy && ctx[key].dispose(\"scoped\");\n\t\t\t}\n\t\tthis._.stabilizerTM && clearTimeout(this._.stabilizerTM);\n\t\tthis._.propagTM && clearTimeout(this._.propagTM);\n\t\tObject.keys(\n\t\t\tthis._._listening\n\t\t).forEach(\n\t\t\tid => ((id !== \"$parent\") && this._._scope[id].removeListener(this._._listening[id]))\n\t\t);\n\t\twhile ( this._._mixedList.length ) {\n\t\t\tthis._._mixed[0].removeListener(this._._mixedList.shift());\n\t\t\tthis._._mixed.shift().dispose(\"mixedTo\");\n\t\t}\n\t\t[...this._.followers].map(follower => this.unBind(...follower));\n\t\tif ( this._._parentList ) {\n\t\t\tthis.parent._rmChild(this);\n\t\t\tthis.parent.removeListener(this._._parentList);\n\t\t\tthis.parent.dispose(\"isMyParent\");\n\t\t\tthis._._parentList = null;\n\t\t}\n\t\tthis.dead = true;\n\t\tdelete allScopes[this._id];\n\t\tthis.emit(\"destroy\", this);\n\t\t\n\t\t\n\t}\n}\n\n\nScope.isScopable = function ( obj ) {\n\treturn Scope.isScope(obj)\n\t\t|| Scope.isScopeClass(obj)\n\t\t|| Scope.isStore(obj)\n\t\t|| Scope.isStoreClass(obj);\n};\n\nScope.isScope = function ( obj ) {\n\treturn obj instanceof Scope\n};\n\nScope.isScopeClass = function ( obj ) {\n\treturn Scope.isPrototypeOf(obj) || obj === Scope\n};\nexport default Scope;","/*\n *   The MIT License (MIT)\n *   Copyright (c) 2019. Wise Wild Web\n *\n *   Permission is hereby granted, free of charge, to any person obtaining a copy\n *   of this software and associated documentation files (the \"Software\"), to deal\n *   in the Software without restriction, including without limitation the rights\n *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *   copies of the Software, and to permit persons to whom the Software is\n *   furnished to do so, subject to the following conditions:\n *\n *   The above copyright notice and this permission notice shall be included in all\n *   copies or substantial portions of the Software.\n *\n *   THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n *   SOFTWARE.\n *\n *   @author : Nathanael Braun\n *   @contact : n8tz.js@gmail.com\n */\n\nconst is                           = require('is'),\n      Scope                        = require('./Scope').default,\n      { keyWalknSet, keyWalknGet } = require('./utils/utils'),\n      EventEmitter                 = require('./utils/Emitter').default,\n      TaskSequencer                = require('./utils/TaskSequencer').default,\n      shortid                      = require('shortid'),\n      objProto                     = Object.getPrototypeOf({});\n\nclass Store extends EventEmitter {\n\t//static use                  = [];// overridable list of source stores\n\tstatic follow;// overridable list of store that will allow push if updated\n\tstatic require;\n\tstatic staticScope   = new Scope({}, { id: \"static\" });\n\tstatic state         = undefined;// default state\n\t/**\n\t * if retain goes to 0 :\n\t * false to not destroy,\n\t * 0 to sync auto destroy\n\t * Ms to autodestroy after tm ms if no retain has been called\n\t * @type {boolean|Int}\n\t */\n\tstatic persistenceTm = false;\n\t\n\t/**\n\t * Constructor, will build a rescope store\n\t *\n\t * (scope, {require,use,apply,state, data})\n\t * (scope)\n\t *\n\t * @param scope {object} scope where to find the other stores (default : static\n\t *     staticScope )\n\t * @param keys {Array} (passed to Store::map) Ex : [\"session\", \"otherNamedStore:key\",\n\t *     otherStore.as(\"otherKey\")]\n\t */\n\tconstructor() {\n\t\tsuper();\n\t\tlet argz         = [...arguments],\n\t\t    _static      = this.constructor,\n\t\t    scope        = argz[0] instanceof Scope\n\t\t                   ? argz.shift()\n\t\t                   : _static.scope ? Scope.getScope(_static.scope)\n\t\t                                   : is.string(argz[0])\n\t\t                                     ? Scope.getScope(argz.shift())\n\t\t                                     : _static.staticScope,\n\t\t    cfg          = argz[0] && !is.array(argz[0]) && !is.string(argz[0])\n\t\t                   ? argz.shift()\n\t\t                   : {},\n\t\t    taskQueue    = is.array(argz[0]) ? argz.shift() : null,\n\t\t    name         = cfg.name || _static.name,\n\t\t    watchs       = cfg.use || [],\n\t\t    apply        = cfg.apply || null,\n\t\t    initialState = _static.state || _static.initialState || _static.defaultState;\n\t\t\n\t\tthis._uid = cfg._uid || shortid.generate();\n\t\t\n\t\tthis.__retains    = { all: 0 };\n\t\tthis.__locks      = { all: 0 };\n\t\tthis._onStabilize = [];\n\t\t\n\t\t// autoDestroyTm\n\t\tthis._autoDestroy   = !!this._persistenceTm;\n\t\tthis._persistenceTm = cfg.persistenceTm || _static.persistenceTm || (cfg.autoDestroy || _static.autoDestroy) && 5;\n\t\tthis._cfg           = cfg;\n\t\t\n\t\tif ( cfg && cfg.on ) {\n\t\t\tthis.on(cfg.on);\n\t\t}\n\t\t\n\t\tthis.name = name;\n\t\t\n\t\tif ( scope.stores ) {\n\t\t\tthis.scopeObj = scope;\n\t\t\tthis.scope    = scope.stores;\n\t\t}\n\t\telse {\n\t\t\tthis.scopeObj = new Scope(scope);\n\t\t\tthis.scope    = scope.stores;\n\t\t}\n\t\t\n\t\t// standardized scope access\n\t\tthis.$scope    = this.scopeObj;\n\t\tthis.$stores   = this.scopeObj.stores;\n\t\tthis.$actions  = this.scopeObj.actions;\n\t\tthis.$dispatch = this.scopeObj.dispatch.bind(this.scopeObj);\n\t\t\n\t\tthis._rev     = this.constructor._rev || 0;\n\t\tthis._revs    = {};\n\t\tthis.stores   = {};\n\t\tthis._require = [];\n\t\tthis._sources = [name];\n\t\t\n\t\t// register source stores\n\t\tif ( is.array(_static.use) ) {\n\t\t\tthis._use = [...watchs, ...(_static.use || []).map(\n\t\t\t\tkey => {\n\t\t\t\t\tlet ref = key.match(/^(\\!?)([^\\:]*)(?:\\:(.*))?$/);\n\t\t\t\t\tif ( ref[1] ) {\n\t\t\t\t\t\tlet ref2 = ref[2].split('.');\n\t\t\t\t\t\tthis._require.push(ref[3] || ref2[ref2.length - 1]);// require check value of the aliased\n\t\t\t\t\t                                                        // imported value\n\t\t\t\t\t\treturn key.substr(1);\n\t\t\t\t\t}\n\t\t\t\t\treturn key;\n\t\t\t\t}\n\t\t\t)];\n\t\t}\n\t\telse {\n\t\t\tthis._use = [...watchs, ...(\n\t\t\t\t_static.use ? Object.keys(_static.use)\n\t\t\t\t                    .map(\n\t\t\t\t\t                    key => {\n\t\t\t\t\t\t                    let ref = key.match(/^(\\!?)(.*)$/);\n\t\t\t\t\t\t                    ref[1] && this._require.push(_static.use[key]);\n\t\t\t\t\t\t                    return ref[2] + ((_static.use[key] === true)\n\t\t\t\t\t\t                                     ? ''\n\t\t\t\t\t\t                                     : ':' + _static.use[key]);\n\t\t\t\t\t                    }\n\t\t\t\t                    ) : []\n\t\t\t)];\n\t\t}\n\t\t\n\t\tif ( _static.require )\n\t\t\tthis._require.push(..._static.require);\n\t\tif ( cfg.require )\n\t\t\tthis._require.push(...cfg.require);\n\t\t\n\t\tthis._followers = [];\n\t\tthis._changesSW = initialState || {};\n\t\tthis.state      = initialState && {};\n\t\t\n\t\tif ( apply )\n\t\t\tthis.apply = apply;\n\t\t\n\t\t/**\n\t\t * Initial state isn't fully initialized ( childs constructors can set it )\n\t\t * Scope based instance have taskQueue to delay init synchronously, if not\n\t\t * present we use setTimeout\n\t\t */\n\t\tif ( taskQueue ) {\n\t\t\ttaskQueue.push(this._afterConstructor.bind(this))\n\t\t}\n\t\telse\n\t\t\tsetTimeout(this._afterConstructor.bind(this))\n\t}\n\t\n\t/**\n\t * Get the incoming state ( for immediate state relative actions )\n\t * @returns {{}|*}\n\t */\n\tget nextState() {\n\t\treturn this._nextState || this.state;\n\t}\n\t\n\t_afterConstructor() {\n\t\tlet cfg          = this._cfg,\n\t\t    _static      = this.constructor,\n\t\t    snapshot     = this.restore(undefined, true),\n\t\t    initialState = this.state,\n\t\t    initialData  = this.data,\n\t\t    applied;\n\t\t{\n\t\t\t\n\t\t\tif ( initialData )\n\t\t\t\tthis.data = initialData;\n\t\t\telse if ( _static.data !== undefined )\n\t\t\t\tthis.data = { ..._static.data };\n\t\t\telse if ( cfg.hasOwnProperty(\"data\") )\n\t\t\t\tthis.data = cfg.data;\n\t\t\t\n\t\t\tif ( cfg.hasOwnProperty(\"state\") && cfg.state !== undefined )\n\t\t\t\tinitialState = { ...initialState, ...cfg.state };\n\t\t\t\n\t\t\tif ( this.data === undefined ) {\n\t\t\t\tif ( initialState || this._use.length ) {// sync apply\n\t\t\t\t\tthis._nextState = this._changesSW = {\n\t\t\t\t\t\t...this._changesSW,\n\t\t\t\t\t\t...(initialState || {}),\n\t\t\t\t\t\t...this.$scope.map(this, this._use)\n\t\t\t\t\t};\n\t\t\t\t\tthis.state      = {};\n\t\t\t\t\tif ( this.shouldApply(this._nextState) && this.data === undefined ) {\n\t\t\t\t\t\tthis.data       = this.apply(this.data, this._nextState, this._changesSW);\n\t\t\t\t\t\tapplied         = true;\n\t\t\t\t\t\tthis.state      = this._changesSW;\n\t\t\t\t\t\tthis._nextState = this._changesSW = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tapplied         = true;\n\t\t\t\tthis.state      = {// assume this state is sync with initial data\n\t\t\t\t\t...this._changesSW,\n\t\t\t\t\t...(initialState || {}),\n\t\t\t\t\t...this.$scope.map(this, this._use)\n\t\t\t\t};\n\t\t\t\tthis._nextState = this._changesSW = null;\n\t\t\t}\n\t\t}\n\t\tif ( (this.data !== undefined || applied) && !this.__locks.all ) {\n\t\t\tthis._stable = true;\n\t\t\tthis._rev++;\n\t\t}\n\t\telse {\n\t\t\tthis._stable = false;\n\t\t\tif ( !_static.managed && !this.state && (!this._use || !this._use.length) ) {\n\t\t\t\tconsole.warn(\"ReScope store '\", this.name, \"' have no initial data, state or use. It can't stabilize...\");\n\t\t\t}\n\t\t}\n\t\t!this._stable && this.emit('unstable', this.state);\n\t\t\n\t}\n\t\n\t/**\n\t * Overridable method to know if a data change should be propag to the listening\n\t * stores & components\n\t */\n\tshouldPropag( nDatas ) {\n\t\treturn true;\n\t}\n\t\n\t/**\n\t * Overridable method to choose if this store should be serialized,\n\t * If not it will be applied normally when restoring\n\t * @returns {boolean}\n\t */\n\tshouldSerialize() {\n\t\treturn true;\n\t}\n\t\n\thasDataChange( nDatas ) {\n\t\tlet _static = this.constructor, r,\n\t\t    cDatas  = this.data;\n\t\tr           = !cDatas && nDatas || cDatas !== nDatas;\n\t\t!r && cDatas && Object.keys(cDatas).forEach(\n\t\t\t( key ) => {\n\t\t\t\tr = r || (nDatas\n\t\t\t\t          ? cDatas[key] !== nDatas[key]\n\t\t\t\t          : cDatas && cDatas[key])\n\t\t\t}\n\t\t);\n\t\t!r && nDatas && Object.keys(nDatas).forEach(\n\t\t\t( key ) => {\n\t\t\t\tr = r || (nDatas\n\t\t\t\t          ? cDatas[key] !== nDatas[key]\n\t\t\t\t          : cDatas && cDatas[key])\n\t\t\t}\n\t\t);\n\t\treturn r;\n\t}\n\t\n\t/**\n\t * Overridable method to know if a state change should be applied\n\t */\n\tshouldApply( state = this.state ) {\n\t\tlet _static = this.constructor;\n\t\t\n\t\treturn (\n\t\t\t!!this.isComplete(state)\n\t\t) && (is.array(_static.follow)\n\t\t      ? _static.follow\n\t\t               .reduce(( r, i ) => (r || state && state[i]), false)\n\t\t      : _static.follow\n\t\t        ? Object.keys(_static.follow)\n\t\t                .reduce(( r, i ) => (\n\t\t\t                r\n\t\t\t                || state && is.fn(_static.follow[i]) && _static.follow[i].call(this, state[i])\n\t\t\t                || _static.follow[i] && state[i] !== this.state[i]\n\t\t                ), false) : true\n\t\t);\n\t}\n\t\n\t/**\n\t * Overridable applier / remapper\n\t * If state or lastPublicState are simple hash maps apply will return {...data,\n\t * ...state} if not it will return the last private state\n\t * @param data\n\t * @param state\n\t * @returns {*}\n\t */\n\tapply( data, state, changes ) {\n\t\treturn state;\n\t}\n\t\n\t/**\n\t * Debounce this store propagation ( & reducing )\n\t * @param cb\n\t */\n\tstabilize( cb ) {\n\t\tcb && this.once('stable', cb);\n\t\t\n\t\tif ( this._stabilizer )\n\t\t\treturn;\n\t\tthis._stable && this.emit('unstable', this.state, this.data);\n\t\tthis._stable = false;\n\t\t\n\t\tthis._stabilizer = TaskSequencer.pushTask(this, 'pushState');\n\t}\n\t\n\t/**\n\t * Walk n get\n\t * @param path\n\t * @param i\n\t * @param obj\n\t * @returns {*|{}}\n\t */\n\tretrieve( path, i = 0, obj = this.data ) {\n\t\tpath = is.string(path) ? path.split('.') : path;\n\t\treturn !obj || !path || !path.length\n\t\t       ? obj\n\t\t       : path.length == i + 1\n\t\t         ? obj[path[i]]\n\t\t         : this.retrieve(path, i + 1, obj[path[i]]);\n\t}\n\t\n\tdispatch( action, ...argz ) {\n\t\tthis.scopeObj.dispatch(action, ...argz);\n\t}\n\t\n\ttrigger( action, ...argz ) {\n\t\tlet { actions } = this.constructor;\n\t\tif ( actions && actions[action] ) {\n\t\t\tlet ns = actions[action].call(this, ...argz);\n\t\t\tif ( is.function(ns) )\n\t\t\t\tns = ns(this.nextState);\n\t\t\tns && this.setState(ns);\n\t\t}\n\t}\n\t\n\t/**\n\t * Set & Push the result data to followers if stable\n\t * @param cb\n\t */\n\tpush( data, force, cb ) {\n\t\tcb    = force === true ? cb : force;\n\t\tforce = force === true;\n\t\tif ( !force &&\n\t\t\t(\n\t\t\t\t!this.hasDataChange(data)\n\t\t\t)\n\t\t) {\n\t\t\tcb && cb();\n\t\t\tif ( !this.__locks.all ) {\n\t\t\t\tlet stable   = this._stable;\n\t\t\t\tthis._stable = true;\n\t\t\t\t!stable && this.emit('stable', this.state, this.data);\n\t\t\t\t//this._stabilizer = null;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.data = data;\n\t\tthis.wait();\n\t\tthis.release(cb);\n\t\t\n\t}\n\t\n\t/**\n\t * Call the apply fn using the current accumulated state update then, push the\n\t * resulting data if stable\n\t * @param forcedState\n\t */\n\tpushState( forcedState ) {\n\t\tthis._stabilizer = null;\n\t\tif ( !forcedState && !this._changesSW && this.data )\n\t\t\treturn;\n\t\t\n\t\tlet nextState = forcedState || this._nextState || this.state,\n\t\t    nextData;\n\t\tObject.keys(nextState).forEach(\n\t\t\tkey => (nextState[key] === undefined && (delete nextState[key]))\n\t\t);\n\t\tnextData = this.apply(this.data, nextState, this._changesSW);\n\t\t\n\t\tthis.state      = nextState;\n\t\tthis._nextState = null;\n\t\tthis._changesSW = null;\n\t\t\n\t\tif ( !forcedState &&\n\t\t\t(\n\t\t\t\t!this.hasDataChange(nextData)\n\t\t\t)\n\t\t) {\n\t\t\tif ( !this.__locks.all ) {\n\t\t\t\tlet stable   = this._stable;\n\t\t\t\tthis._stable = true;\n\t\t\t\t!stable && this.emit('stable', this.state, this.data);\n\t\t\t\tthis._stabilizer = null;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tthis.data = nextData;\n\t\tthis.wait();\n\t\tthis.release();\n\t}\n\t\n\t/**\n\t * Add 'pState' to the current accumulated state updates\n\t * & wait source stores stabilization before pushing these state updates\n\t * @param pState\n\t * @param cb\n\t */\n\tsetState( pState, cb, sync ) {\n\t\tlet change,\n\t\t    changes   = this._changesSW = this._changesSW || {},\n\t\t    nextState = this._nextState = this._nextState || { ...this.state },\n\t\t    key;\n\t\tfor ( key in pState )\n\t\t\tif ( !this.state\n\t\t\t\t|| changes.hasOwnProperty(key)// todo\n\t\t\t\t&& (\n\t\t\t\t\tpState[key] !== changes[key]\n\t\t\t\t) || pState.hasOwnProperty(key)\n\t\t\t\t&& (\n\t\t\t\t\tpState[key] !== this.state[key]\n\t\t\t\t) ) {\n\t\t\t\tchange         = true;\n\t\t\t\tnextState[key] = changes[key] = pState[key];\n\t\t\t}\n\t\t\n\t\tif ( !this.shouldApply(nextState) ) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif ( sync ) {\n\t\t\tthis.pushState();\n\t\t\tcb && cb();\n\t\t}\n\t\telse {\n\t\t\tif ( change ) {\n\t\t\t\tthis.stabilize(cb);\n\t\t\t}\n\t\t\telse cb && cb();\n\t\t}\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Update the current state & push it\n\t * @param pState\n\t * @param cb\n\t */\n\tsetStateSync( pState ) {\n\t\tlet i       = 0, change,\n\t\t    changes = this._changesSW = this._changesSW || {};\n\t\tfor ( let k in pState )\n\t\t\tif ( !this.state || pState.hasOwnProperty(k)\n\t\t\t\t&& (\n\t\t\t\t\tpState[k] !== this.state[k]\n\t\t\t\t\t//||\n\t\t\t\t\t//(this.state[k] && pState[k] && (pState[k]._rev != this._revs[k]))// rev/hash update\n\t\t\t\t) ) {\n\t\t\t\tchange        = true;\n\t\t\t\tthis._revs[k] = pState[k] && pState[k]._rev || true;\n\t\t\t\tchanges[k]    = pState[k];\n\t\t\t}\n\t\tthis.shouldApply({ ...(this.state || {}), ...changes }) && this.pushState();\n\t\treturn this.data;\n\t}\n\t\n\t/**\n\t * get a store-key pair for Store::map\n\t * @param {string} name\n\t * @returns {{store: Store, name: *}}\n\t */\n\tas( name ) {\n\t\treturn { store: this, name };\n\t}\n\t\n\ton( lists ) {\n\t\tif ( !is.string(lists) && lists )\n\t\t\tObject.keys(lists).forEach(k => super.on(k, lists[k]));\n\t\telse super.on(...arguments);\n\t}\n\t\n\tremoveListener( lists ) {\n\t\tif ( !is.string(lists) && lists )\n\t\t\tObject.keys(lists).forEach(k => super.removeListener(k, lists[k]));\n\t\telse super.removeListener(...arguments);\n\t}\n\t\n\t/**\n\t * is complete (all requiered keys are here)\n\t * @returns bool\n\t */\n\tisComplete( state = this.state ) {\n\t\treturn (\n\t\t\t!this._require\n\t\t\t|| !this._require.length\n\t\t\t|| state && this._require.reduce(\n\t\t\t\t( r, key ) => (r && state[key]),\n\t\t\t\ttrue\n\t\t\t)\n\t\t);\n\t}\n\t\n\t/**\n\t * is stable\n\t * @returns bool\n\t */\n\tisStable() {\n\t\treturn this._stable;\n\t}\n\t\n\t/**\n\t * Serialize state & data with sources refs\n\t * @returns bool\n\t */\n\tserialize( cfg = {}, output = {} ) {\n\t\t\n\t\tlet sId        = cfg.parentAlias || this.scopeObj._id,\n\t\t    refsCount  = 0,\n\t\t    refs       =\n\t\t\t    !cfg.norefs && is.array(this._use) && this._use.reduce(\n\t\t\t    ( map, key ) => {\n\t\t\t\t    let ref   = this.$scope.parseRef(key),\n\t\t\t\t        store = this.$stores[ref.storeId];\n\t\t\t\t    if ( store && Store.isStore(store) && !store.scopeObj._.isLocalId )\n\t\t\t\t\t    refsCount++, map[ref.alias] = ref.path;\n\t\t\t\t\n\t\t\t\t    return map;\n\t\t\t    }, {}\n\t\t\t    ),\n\t\t    state      = this.state || {},\n\t\t    persistent = this.shouldSerialize();\n\t\t\n\t\tif ( !persistent ) {\n\t\t\tkeyWalknSet(\n\t\t\t\toutput,\n\t\t\t\t(sId + '/' + this.name),\n\t\t\t\t{\n\t\t\t\t\tdataRefs: cfg.dataRefs,\n\t\t\t\t\trefs\n\t\t\t\t}\n\t\t\t);\n\t\t\treturn output;\n\t\t}\n\t\t\n\t\tlet\n\t\t\tstateKeys   = Object.keys(state) || [],\n\t\t\tstateRefs   = stateKeys.map(k => state[k]),\n\t\t\tinRefsCount = 0,\n\t\t\tdataRefs    = cfg.dataRefs || {},\n\t\t\tinRefs      =\n\t\t\t\t!cfg.norefs && this.data && (Object.keys(this.data).reduce(\n\t\t\t\t( map, key ) => {\n\t\t\t\t\tlet ref = stateRefs.indexOf(this.data[key])\n\t\t\t\t\tif ( ref != -1 )\n\t\t\t\t\t\tinRefsCount++, map[key] = stateKeys[ref];\n\t\t\t\t\treturn map;\n\t\t\t\t}, {}\n\t\t\t\t)),\n\t\t\tsnap        = {\n\t\t\t\tdataRefs: cfg.dataRefs,\n\t\t\t\tstate   : state &&\n\t\t\t\t\t(\n\t\t\t\t\t\tcfg.norefs\n\t\t\t\t\t\t? { ...state }\n\t\t\t\t\t\t: Object.keys(state).reduce(( h, k ) => (!refs[k] && (h[k] = state[k]), h), {})\n\t\t\t\t\t),\n\t\t\t\tdata    : (\n\t\t\t\t\t\tthis.data &&\n\t\t\t\t\t\tthis.data.__proto__ === objProto ?\n\t\t\t\t\t\tObject\n\t\t\t\t\t\t\t.keys(this.data)\n\t\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t\t( h, k ) => {\n\t\t\t\t\t\t\t\t\tif ( !inRefs[k] && !dataRefs[k] ) {\n\t\t\t\t\t\t\t\t\t\th[k] = this.data[k];\n\t\t\t\t\t\t\t\t\t\tinRefsCount++;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn h\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t                                 :\n\t\t\t\t\t\t(is.bool(this.data)\n\t\t\t\t\t\t\t|| is.number(this.data)\n\t\t\t\t\t\t\t|| is.string(this.data)) && this.data\n\t\t\t\t\t)\n\t\t\t\t\t|| undefined\n\t\t\t\t\n\t\t\t};\n\t\t\n\t\trefs && refsCount && (snap.refs = refs);\n\t\tinRefs && inRefsCount && (\n\t\t\tsnap.inRefs = inRefs);\n\t\t\n\t\t\n\t\tkeyWalknSet(\n\t\t\toutput,\n\t\t\t(sId + '/' + this.name),\n\t\t\tsnap\n\t\t);\n\t\treturn output;\n\t}\n\t\n\t/**\n\t * restore state & data\n\t * @returns bool\n\t */\n\trestore( snapshot, immediate ) {\n\t\tsnapshot = snapshot\n\t\t\t&& keyWalknGet(snapshot, this.scopeObj._id + '/' + this.name)\n\t\t\t|| this.$scope.takeSnapshotByKey(this.scopeObj._id + '/' + this.name);\n\t\t\n\t\tif ( !snapshot )\n\t\t\treturn;\n\t\t\n\t\tif ( snapshot ) {\n\t\t\t\n\t\t\tif ( !this.isStable() && !immediate )\n\t\t\t\tthis.then(() => this.restore(snapshot));\n\t\t\t\n\t\t\tthis.state = { ...snapshot.state };\n\t\t\tsnapshot.refs && Object.keys(snapshot.refs).forEach(\n\t\t\t\t( key ) => {//todo\n\t\t\t\t\tthis.state[key] = this.$scope.retrieve(snapshot.refs[key]);\n\t\t\t\t}\n\t\t\t)\n\t\t\t\n\t\t\t\n\t\t\tif ( snapshot.inRefs === true ) {\n\t\t\t\tthis.data = { ...this.state };\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.data = snapshot.data;\n\t\t\t\tsnapshot.inRefs && Object.keys(snapshot.inRefs).forEach(\n\t\t\t\t\t( key ) => {//todo\n\t\t\t\t\t\tthis.data[key] = this.state[snapshot.inRefs[key]];\n\t\t\t\t\t\t//else\n\t\t\t\t\t\t//    console.warn('not found : ', key, snap && snap.refs[ key ])\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\tif ( snapshot.dataRefs ) {\n\t\t\t\tthis.data = this.data || {};\n\t\t\t\tObject.keys(snapshot.dataRefs).forEach(\n\t\t\t\t\t( key ) => {//todo\n\t\t\t\t\t\tthis.$scope.restoreRefPath(snapshot.dataRefs[key]);\n\t\t\t\t\t\tthis.data[key] = this.$scope.retrieve(snapshot.dataRefs[key]);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t}\n\t}\n\t\n\t/**\n\t * Bind this store changes to the given component-key\n\t * @param obj {React.Component|Store|function)\n\t * @param key {string} optional key where to map the public state\n\t */\n\tbind( obj, key, setInitial = true, path ) {\n\t\tthis._followers.push([obj, key, path]);\n\t\tif ( setInitial && this.data && this._stable ) {\n\t\t\tlet data = path ? this.retrieve(path) : this.data;\n\t\t\tif ( typeof obj != \"function\" ) {\n\t\t\t\tif ( key ) obj.setState({ [key]: data });\n\t\t\t\telse obj.setState(data);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj(data);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * Un bind this store off the given component-key\n\t * @param obj\n\t * @param key\n\t * @returns {Array.<*>}\n\t */\n\tunBind( obj, key, path ) {\n\t\tlet followers = this._followers,\n\t\t    i         = followers && followers.length;\n\t\twhile ( followers && i-- )\n\t\t\tif ( followers[i][0] === obj && followers[i][1] === key && followers[i][2] === path )\n\t\t\t\treturn followers.splice(i, 1);\n\t}\n\t\n\t/**\n\t * once('stable', cb)\n\t * @param obj {React.Component|Store|function)\n\t * @param key {string} optional key where to map the public state\n\t */\n\tthen( cb ) {\n\t\tif ( this._stable )\n\t\t\treturn cb(this.data);\n\t\tthis.once('stable', e => cb(this.data));\n\t}\n\t\n\t/**\n\t * Add a lock so the store will not propag it data untill release() is call\n\t * @param previous {Store|number|Array} @optional wf to wait, releases to wait or\n\t *     array of stuff to wait\n\t * @returns {this}\n\t */\n\twait( previous ) {\n\t\tif ( typeof previous == \"number\" )\n\t\t\treturn this.__locks.all += previous;\n\t\tif ( is.array(previous) )\n\t\t\treturn previous.map(this.wait.bind(this));\n\t\t\n\t\tthis._stable && this.emit('unstable', this.state, this.data);\n\t\tthis._stable = false;\n\t\tthis.__locks.all++;\n\t\t\n\t\tlet reason = is.string(previous) ? previous : null;\n\t\tif ( reason ) {\n\t\t\tthis.__locks[reason] = this.__locks[reason] || 0;\n\t\t\tthis.__locks[reason]++;\n\t\t}\n\t\tif ( previous && is.fn(previous.then) ) {\n\t\t\tprevious.then(this.release.bind(this, null));\n\t\t}\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Decrease locks for this store, if it reach 0 ,\n\t * it will be propagated to the followers,\n\t * then, all stuff passed to \"then\" call back will be exec / released\n\t * @param desync\n\t * @returns {*}\n\t */\n\trelease( reason, cb ) {\n\t\tlet _static = this.constructor, me = this;\n\t\tlet i       = 0, wasStable = this._stable;\n\t\t\n\t\tif ( is.fn(reason) ) {\n\t\t\tcb     = reason;\n\t\t\treason = null;\n\t\t}\n\t\t\n\t\tif ( reason ) {\n\t\t\tif ( this.__locks[reason] == 0 )\n\t\t\t\tconsole.error(\"Release more than locking !\", reason);\n\t\t\tthis.__locks[reason] = this.__locks[reason] || 0;\n\t\t\tthis.__locks[reason]--;\n\t\t}\n\t\t\n\t\tif ( !reason && this.__locks.all == 0 )\n\t\t\tconsole.error(\"Release more than locking !\");\n\t\t\n\t\tif ( !--this.__locks.all && this.isComplete() ) {\n\t\t\tlet propag   = this.shouldPropag(this.data);\n\t\t\tthis._stable = true;\n\t\t\tpropag && this._rev++;//\n\t\t\tif ( propag && this._followers.length )\n\t\t\t\tthis._followers.forEach(function propag( follower ) {\n\t\t\t\t\tlet data = follower[2] ? me.retrieve(follower[2]) : me.data;\n\t\t\t\t\t//if ( !data ) return;\n\t\t\t\t\t\n\t\t\t\t\tif ( typeof follower[0] == \"function\" ) {\n\t\t\t\t\t\tfollower[0](data);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t//cb && i++;\n\t\t\t\t\t\tfollower[0].setState(\n\t\t\t\t\t\t\t(follower[1]) ? { [follower[1]]: data }\n\t\t\t\t\t\t\t              : data\n\t\t\t\t\t\t\t//,\n\t\t\t\t\t\t\t//cb && (\n\t\t\t\t\t\t\t//    () => (!(--i) && cb())\n\t\t\t\t\t\t\t//)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t//else\n\t\t\t!wasStable && this.emit('stable', this.data);\n\t\t\tpropag && this.emit('update', this.data);\n\t\t\tcb && cb()\n\t\t}\n\t\telse cb && this.then(cb);\n\t\treturn this;\n\t}\n\t\n\tpropag( data ) {\n\t\tthis.emit('update', data);\n\t}\n\t\n\tretain( reason ) {\n\t\tthis.__retains.all++;\n\t\tif ( reason ) {\n\t\t\tthis.__retains[reason] = this.__retains[reason] || 0;\n\t\t\tthis.__retains[reason]++;\n\t\t}\n\t}\n\t\n\tdispose( reason ) {\n\t\t//console.warn(\"dispose\", reason, this.__retains);\n\t\tif ( reason ) {\n\t\t\tif ( !this.__retains[reason] ) {\n\t\t\t\tthrow new Error(\"RS : Dispose more than retaining on store '\" + this.name + \"' : \" + reason);\n\t\t\t}\n\t\t\t\n\t\t\tthis.__retains[reason]--;\n\t\t}\n\t\tif ( this.__retains.all == 0 ) {\n\t\t\tthrow new Error(\"RS : Dispose more than retaining on store \" + this.name);\n\t\t}\n\t\t\n\t\tthis.__retains.all--;\n\t\t\n\t\tif ( !this.__retains.all ) {\n\t\t\tif ( this._persistenceTm ) {\n\t\t\t\tthis._destroyTM && clearTimeout(this._destroyTM);\n\t\t\t\tthis._destroyTM = setTimeout(\n\t\t\t\t\te => {\n\t\t\t\t\t\tthis._destroyTM = null;\n\t\t\t\t\t\t//this.then(s => {\n\t\t\t\t\t\t!this.__retains.all && !this.dead && this.destroy()\n\t\t\t\t\t\t//});\n\t\t\t\t\t},\n\t\t\t\t\tthis._persistenceTm\n\t\t\t\t);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//this.then(s =>\n\t\t\t\t(!this.__retains.all && !this.dead && this.destroy())\n\t\t\t\t//);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tdestroy() {\n\t\t//  console.log(\"destroy\", this._uid);\n\t\t\n\t\tif ( this._stabilizer ) {\n\t\t\tthis._stabilizer = null;\n\t\t\tclearTimeout(this._stabilizer);\n\t\t}\n\t\tthis.emit('destroy', this);\n\t\t\n\t\tif ( this._followers.length )\n\t\t\tthis._followers.forEach(\n\t\t\t\t( follower ) => {\n\t\t\t\t\tif ( typeof follower[0] !== \"function\" ) {\n\t\t\t\t\t\tif ( follower[0].stores )\n\t\t\t\t\t\t\tdelete follower[0].stores[follower[1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\tthis._followers.length = 0;\n\t\tthis.constructor._rev  = this.rev;\n\t\tthis.dead              = true;\n\t\tthis._revs             = this.data = this.state = this.scope = null;\n\t\tthis.removeAllListeners();\n\t}\n}\n\n/**\n * get a static aliased reference of a store\n * @param {string} name\n * @returns {{store: Store, name: *}}\n */\nStore.as = function ( name ) {\n\treturn { store: this, name };\n}\n\n/**\n * @todo\n * Map all named stores in {keys} to the {object}'s state\n * Hook componentWillUnmount (for react comp) or destroy to unBind them automatically\n * @static\n * @param object {Object} target state aware object (React.Component|Store|...)\n * @param keys {Array} Ex : [\"session\", \"otherStaticNamedStore:key\",\n *     store.as('anotherKey')]\n */\nStore.map = function ( cStore, keys, scope, origin, setInitial = false ) {\n\tlet targetRevs     = cStore._revs || {};\n\tlet targetScope    = cStore.stores || (cStore.stores = {});\n\tlet initialOutputs = {};\n\tkeys               = is.array(keys) ? [...keys] : [keys];\n\t\n\t\n\tscope = scope || Store.staticScope;\n\t\n\tkeys = keys.filter(\n\t\t// @todo : use query refs\n\t\t// (store)(\\.store)*(\\[(\\*|(props)\\w+)+)\\])?(\\:alias)\n\t\t( key ) => {\n\t\t\tif ( !key ) {\n\t\t\t\tconsole.error(\"Not a mappable store item '\" + key + \"' in \" + origin + ' !!');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet name,\n\t\t\t    alias,\n\t\t\t    path,\n\t\t\t    store, _key;\n\t\t\tif ( key.store && key.name ) {\n\t\t\t\talias = name = key.name;\n\t\t\t\tstore = key.store;\n\t\t\t}\n\t\t\telse if ( is.fn(key) ) {\n\t\t\t\tname  = alias = key.name || key.defaultName;\n\t\t\t\tstore = key;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_key  = key.match(/([^\\.\\:]+)((?:\\.[^\\.\\:]+)*)(?:\\:([^\\.\\:]+))?/);\n\t\t\t\tname  = _key[1];\n\t\t\t\tpath  = _key[2] && _key[2].substr(1);\n\t\t\t\tstore = scope.stores[_key[1]];\n\t\t\t\talias = _key[3] || path && path.match(/([^\\.]*)$/)[0] || _key[1];\n\t\t\t}\n\t\t\tif ( !store ) {\n\t\t\t\tlet i = [];\n\t\t\t\tfor ( let o in scope.stores )\n\t\t\t\t\ti.push(o)\n\t\t\t\tconsole.error(\"Not a mappable store item '\" + name + \"/\" + alias + \"' in \" + (cStore.name || cStore) + ' !!', store, _key, scope.stores, i);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif ( Scope.isScopeClass(store) ) scope._mount(name);\n\t\t\tif ( Scope.isScope(store) ) {\n\t\t\t\tstore = scope._mount(key);\n\t\t\t}\n\t\t\telse if ( targetRevs[name] ) return false;// ignore dbl uses for now\n\t\t\t\n\t\t\t\n\t\t\tif ( is.fn(store) ) {\n\t\t\t\tscope._mount(name)\n\t\t\t\tscope.stores[name].bind(cStore, alias, setInitial, path);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstore.bind(cStore, alias, setInitial, path);\n\t\t\t}\n\t\t\t\n\t\t\t// give initial store weight basing sources\n\t\t\tscope.stores[name]._sources && cStore._sources.push(...scope.stores[name]._sources);\n\t\t\t\n\t\t\ttargetRevs[alias] = targetRevs[alias] || true;\n\t\t\t!targetScope[name] && (targetScope[name] = scope.stores[name]);\n\t\t\tif ( scope.stores[name].hasOwnProperty('data') )\n\t\t\t\tinitialOutputs[name] = scope.data[name];\n\t\t\treturn true;\n\t\t}\n\t);\n\t\n\t// ... @todo\n\tcStore.once('destroy', ( ...argz ) => {\n\t\tkeys.map(\n\t\t\t( key ) => {\n\t\t\t\tlet name,\n\t\t\t\t    alias, path,\n\t\t\t\t    store;\n\t\t\t\tif ( key.store && key.name ) {\n\t\t\t\t\talias = name = key.name;\n\t\t\t\t\tstore = key.store;\n\t\t\t\t}\n\t\t\t\telse if ( is.fn(key) ) {\n\t\t\t\t\tname  = alias = key.name || key.defaultName;\n\t\t\t\t\tstore = scope.stores[name];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tkey   = key.match(/([^\\.\\:]+)((?:\\.[^\\.\\:]+)*)(?:\\:([^\\.\\:]+))?/);\n\t\t\t\t\tname  = key[1];\n\t\t\t\t\tpath  = key[2] && key[2].substr(1);\n\t\t\t\t\tstore = scope.stores[key[1]];\n\t\t\t\t\talias = key[3] || path && path.match(/([^\\.]*)$/)[0] || key[1];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tstore && !is.fn(store) && store.unBind(cStore, alias, path)\n\t\t\t}\n\t\t);\n\t})\n\t\n\treturn initialOutputs;\n};\n\n\nStore.isStore      = Scope.isStore = function ( obj ) {\n\treturn obj instanceof Store\n}\nStore.isStoreClass = Scope.isStoreClass = function ( obj ) {\n\treturn Store.isPrototypeOf(obj) || obj === Store\n}\n\nexport default Store;","/*\n *   The MIT License (MIT)\n *   Copyright (c) 2019. Wise Wild Web\n *\n *   Permission is hereby granted, free of charge, to any person obtaining a copy\n *   of this software and associated documentation files (the \"Software\"), to deal\n *   in the Software without restriction, including without limitation the rights\n *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *   copies of the Software, and to permit persons to whom the Software is\n *   furnished to do so, subject to the following conditions:\n *\n *   The above copyright notice and this permission notice shall be included in all\n *   copies or substantial portions of the Software.\n *\n *   THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n *   SOFTWARE.\n *\n *   @author : Nathanael Braun\n *   @contact : n8tz.js@gmail.com\n */\n\nlet $global = (typeof window !== 'undefined') ? window : global,\n    Scope   = require('./Scope').default,\n    Store   = require('./Store').default;\n\nconst RS = $global.___rescope || {};\n\nfunction scopeRef( map, key ) {\n\tmap[key] = new Scope.scopeRef(map[key]);\n\treturn map;\n};\nif ( $global.___rescope ) {\n\tconsole.warn(\"ReScope is defined multiple times !! \\nCheck you're packaging\")\n\tScope    = RS.Scope;\n\tStore    = RS.Store;\n\tscopeRef = RS.scopeRef;\n}\nelse {\n\t$global.___rescope = RS;\n\tScope.Store        = Store;\n}\nexport {Scope, Store, scopeRef};\nexport default { Scope, Store, scopeRef };","/*\n *   The MIT License (MIT)\n *   Copyright (c) 2019. Wise Wild Web\n *\n *   Permission is hereby granted, free of charge, to any person obtaining a copy\n *   of this software and associated documentation files (the \"Software\"), to deal\n *   in the Software without restriction, including without limitation the rights\n *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *   copies of the Software, and to permit persons to whom the Software is\n *   furnished to do so, subject to the following conditions:\n *\n *   The above copyright notice and this permission notice shall be included in all\n *   copies or substantial portions of the Software.\n *\n *   THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n *   SOFTWARE.\n *\n *   @author : Nathanael Braun\n *   @contact : n8tz.js@gmail.com\n */\n\nimport is from 'is';\n\nexport default class Emitter {\n\t_events = {};\n\t\n\ton( evt, cb ) {\n\t\tif ( !is.string(evt) && evt )\n\t\t\treturn Object.keys(evt).forEach(k => this.on(k, evt[k]));\n\t\t\n\t\tthis._events[evt] = this._events[evt] || [];\n\t\tthis._events[evt].push(cb);\n\t}\n\t\n\tun( evt, cb ) {\n\t\tif ( !is.string(evt) && evt )\n\t\t\treturn Object.keys(evt).forEach(k => this.un(k, evt[k]));\n\t\t\n\t\tif ( !this._events[evt] ) return;\n\t\tlet i = this._events[evt].indexOf(cb);\n\t\tthis._events[evt].splice(i, 1);\n\t}\n\t\n\temit( evt, ...argz ) {\n\t\tif ( !this._events[evt] ) return;\n\t\tlet lists = [...this._events[evt]];\n\t\t\n\t\tfor ( let i = 0; i < lists.length; i++ )\n\t\t\tlists[i](...argz)\n\t}\n\t\n\taddListener() {\n\t\tthis.on(...arguments);\n\t}\n\t\n\tremoveListener() {\n\t\tthis.un(...arguments);\n\t}\n\t\n\tremoveAllListeners() {\n\t\tthis._events = {};\n\t}\n\t\n\tonce( evt, cb ) {\n\t\tlet fn;\n\t\tthis.on(evt, fn = ( ...argz ) => {\n\t\t\tthis.un(evt, fn);\n\t\t\tcb(...argz)\n\t\t});\n\t}\n\t\n\t\n}","/*\n *   The MIT License (MIT)\n *   Copyright (c) 2019. Wise Wild Web\n *\n *   Permission is hereby granted, free of charge, to any person obtaining a copy\n *   of this software and associated documentation files (the \"Software\"), to deal\n *   in the Software without restriction, including without limitation the rights\n *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *   copies of the Software, and to permit persons to whom the Software is\n *   furnished to do so, subject to the following conditions:\n *\n *   The above copyright notice and this permission notice shall be included in all\n *   copies or substantial portions of the Software.\n *\n *   THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n *   SOFTWARE.\n *\n *   @author : Nathanael Braun\n *   @contact : n8tz.js@gmail.com\n */\n\n/**\n * Minimal push sequencer, apply stores specific task in the right order\n */\nlet taskQueue      = [],\n    curWeight      = 0,\n    maxWeight      = 0,\n    minWeight      = 0,\n    taskCount      = 0,\n    deSync         = false,\n    deSyncMaxTasks = 10,\n    task,\n    isRunning,\n    errorCatcher   = {\n\t    lastError: null,\n\t    dispatch : function ( error ) {\n\t\t    errorCatcher.disable();\n\t\t\n\t\t    if ( task && task[0].handleError ) {\n\t\t\t    task[0].handleError(error, task);\n\t\t    }\n\t\t    else if ( task )\n\t\t\t    console.error(\"ReScope : An apply task has failed !!\", task[1], \" on \", task[0].name || task[0].constructor.name, '\\n', error)\n\t\t\n\t\t    isRunning = false;\n\t\t    task      = null;\n\t\t    runNow();\n\t    },\n\t    enable   : (typeof window !== 'undefined')\n\t               ? () => {\n\t\t\t    window.addEventListener('error', errorCatcher.dispatch)\n\t\t    } : () => {\n\t\t\t    process.on('uncaughtException', errorCatcher.dispatch);\n\t\t    },\n\t    disable  : (typeof window !== 'undefined')\n\t               ? () => {\n\t\t\t    window.removeEventListener('error', errorCatcher.dispatch)\n\t\t    } : () => {\n\t\t\t    process.removeListener('uncaughtException', errorCatcher.dispatch);\n\t\t    }\n    }\n;\n\nfunction runNow() {\n\tif ( !isRunning ) {\n\t\trun();\n\t}\n}\n\nfunction run() {\n\tlet from  = Date.now();\n\tisRunning = true;\n\terrorCatcher.enable();\n\twhile ( taskCount ) {\n\t\t\n\t\t// try for the current weight\n\t\twhile ( !(taskQueue[curWeight] && taskQueue[curWeight].length) )\n\t\t\tcurWeight++;\n\t\t\n\t\ttaskCount--;\n\t\ttask = taskQueue[curWeight].shift();\n\t\t//console.log(\"Task : \", task[1], \" on \", task[0].name);\n\t\ttry {\n\t\t\t!task[0].dead && task[0][task[1]](task[2]);\n\t\t} catch ( e ) {\n\t\t\treturn errorCatcher.dispatch(e);\n\t\t}\n\t}\n\ttask = undefined;\n\terrorCatcher.disable();\n\t\n\tisRunning = false;\n\tif ( taskCount ) {\n\t\tsetTimeout(runNow);\n\t}\n}\n\n//\n//index.setTaskDeSync = ( nb ) => {\n//    if ( nb === false )\n//        return deSync = false;\n//    else if ( nb === true ) {\n//        deSync         = true;\n//        deSyncMaxTasks = 10;\n//    }\n//    else (is.int(nb))\n//    {\n//        deSync         = true;\n//        deSyncMaxTasks = nb;\n//    }\n//};\n\nexport default {\n\tpushTask( obj, fn, argz ) {\n\t\t/**\n\t\t * The more a store have sources, the more it should be processed first\n\t\t * So leafs stores stay sync, and root stores receive merged state updates;\n\t\t * global state stay coherent\n\t\t *\n\t\t * This mean whatever the number of stores & the complexity of the deps,\n\t\t * updating a store state will update its synchrone child stores immediately\n\t\t *\n\t\t *\n\t\t * @type {*|number}\n\t\t */\n\t\tlet weight = obj._sources && obj._sources.length || 1,\n\t\t    stack  = taskQueue[weight] =\n\t\t\t    taskQueue[weight] || [];\n\t\t\n\t\tmaxWeight = Math.max(maxWeight, weight);\n\t\tcurWeight = Math.min(curWeight, weight);\n\t\ttaskCount++;\n\t\t\n\t\t//console.log(\"Push Task : \", fn, \" on \", obj.name, weight);\n\t\tstack.push([obj, fn, argz]);\n\t\tsetTimeout(runNow, 0);\n\t\treturn stack.length;\n\t}\n};","/*\n *   The MIT License (MIT)\n *   Copyright (c) 2019. Wise Wild Web\n *\n *   Permission is hereby granted, free of charge, to any person obtaining a copy\n *   of this software and associated documentation files (the \"Software\"), to deal\n *   in the Software without restriction, including without limitation the rights\n *   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n *   copies of the Software, and to permit persons to whom the Software is\n *   furnished to do so, subject to the following conditions:\n *\n *   The above copyright notice and this permission notice shall be included in all\n *   copies or substantial portions of the Software.\n *\n *   THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n *   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n *   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n *   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n *   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n *   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n *   SOFTWARE.\n *\n *   @author : Nathanael Braun\n *   @contact : n8tz.js@gmail.com\n */\n\nconst is = require('is');\n\nexport function walknSet( obj, path, value, stack ) {\n\tif ( is.string(path) )\n\t\tpath = path.split('.');\n\tif ( !path.length )\n\t\treturn false;\n\telse if ( path.length == 1 )\n\t\treturn obj[path[0]] = stack\n\t\t                      ? [...(obj[path[0]] || []), value]\n\t\t                      : value;\n\telse\n\t\treturn walknSet(\n\t\t\tobj[path[0]] =\n\t\t\t\tobj[path[0]] || {},\n\t\t\tpath.slice(1),\n\t\t\tvalue, stack\n\t\t);\n}\n\nexport function walknGet( obj, path, isKey ) {\n\tif ( is.string(path) )\n\t\tpath = path.split('.');\n\treturn path.length\n\t       ? obj[path[0]] && walknGet(obj[path[0]], path.slice(1))\n\t       : obj;\n}\n\n//@todo\nexport function keyWalknSet( obj, path, value, stack ) {\n\tif ( is.string(path) )\n\t\tpath = path.split(/(\\>|\\/)/ig).filter(v => (v !== '>' && v));\n\treturn walknSet(obj, path, value);\n}\n\nexport function keyWalknGet( obj, path, isKey ) {\n\tif ( is.string(path) )\n\t\tpath = path.split(/(\\>|\\/)/ig).filter(v => (v !== '>' && v));\n\treturn path.length\n\t       ? obj[path[0]] && walknGet(obj[path[0]], path.slice(1))\n\t       : obj;\n}","module.exports = require(\"@babel/runtime/helpers/possibleConstructorReturn\");","module.exports = require(\"@babel/runtime/helpers/defineProperty\");","module.exports = require(\"@babel/runtime/helpers/getPrototypeOf\");","module.exports = require(\"@babel/runtime/helpers/classCallCheck\");","module.exports = require(\"@babel/runtime/helpers/createClass\");","module.exports = require(\"@babel/runtime/helpers/toConsumableArray\");","module.exports = require(\"@babel/runtime/helpers/get\");","module.exports = require(\"is\");","module.exports = require(\"@babel/runtime/helpers/inherits\");","module.exports = require(\"shortid\");","module.exports = require(\"@babel/runtime/helpers/assertThisInitialized\");"],"sourceRoot":""}